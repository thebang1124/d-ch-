
<!DOCTYPE html>
<html lang="vi" class="dark">
<head>
  <meta charset="UTF-8" />
  <title>Dịch Ê‑đê ↔ Việt + Giải đề + Ảnh</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @font-face {
      font-family: 'CharisSIL';
      src: url('https://cdn.jsdelivr.net/gh/silnrsi/font-charis@main/web/CharisSIL-Regular.woff2') format('woff2');
    }
    body { font-family: 'CharisSIL', serif; }
  </style>
</head>
<body class="dark:bg-gray-900 dark:text-white text-black bg-white p-6">
  <div class="max-w-3xl mx-auto space-y-6">

    <h1 class="text-3xl font-bold text-center">📘 Từ điển Ê‑đê ↔ Việt</h1>
    <p class="text-center text-gray-400 text-sm">Tra từ, giải đề, nhận diện hình ảnh và giọng nói</p>

    <!-- Tra từ -->
    <section class="space-y-2">
      <h2 class="text-xl font-semibold">🔍 Dịch từ</h2>
      <input id="inputText" placeholder="Nhập từ tiếng Việt hoặc Ê‑đê..." class="w-full p-2 rounded bg-gray-100 dark:bg-gray-800" />
      <div class="flex gap-2">
        <button onclick="translate()" class="px-4 py-1 bg-blue-600 text-white rounded">Dịch</button>
        <button onclick="startVoice()" class="px-4 py-1 bg-green-600 text-white rounded">🎙️ Nói</button>
      </div>
      <textarea id="outputText" rows="2" class="w-full mt-2 p-2 bg-gray-200 dark:bg-gray-700 rounded" readonly></textarea>
      <div id="exampleText" class="text-sm italic text-green-400"></div>
    </section>

    <!-- OCR dịch -->
    <section class="space-y-2">
      <h2 class="text-xl font-semibold">📷 Dịch từ ảnh</h2>
      <input type="file" accept="image/*" onchange="handleOCR(this.files, false)" />
      <pre id="ocrOutput" class="bg-gray-100 dark:bg-gray-800 p-2 rounded text-sm"></pre>
    </section>

    <!-- OCR giải đề -->
    <section class="space-y-2">
      <h2 class="text-xl font-semibold">📘 Giải đề bài từ ảnh</h2>
      <input type="file" accept="image/*" onchange="handleOCR(this.files, true)" />
      <div id="solveOutput" class="bg-gray-100 dark:bg-gray-800 p-2 rounded text-sm whitespace-pre-wrap"></div>
    </section>

    <footer class="pt-6 text-center text-xs text-gray-400">
      © Phát triển bởi Thế Bằng 2025 – Dành cho giáo dục
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
  <script>
    const dict = {
      "abă": { vi: "cha", example: "abă đhông: cha tôi" },
      "abăn": { vi: "xoa dịu", example: "abăn anak: dỗ con" },
      "amâo": { vi: "lửa", example: "amâo kơtô: lửa cháy" },
      "cha": { ede: "abă", example: "cha hiền lành" },
      "xoa dịu": { ede: "abăn", example: "mẹ xoa dịu đứa bé" },
      "lửa": { ede: "amâo", example: "lửa bốc lên cao" }
    };

    function translate() {
      const input = document.getElementById("inputText").value.trim().toLowerCase();
      const out = dict[input];
      let result = "", ex = "";
      if (out?.vi) { result = out.vi; ex = out.example; }
      else if (out?.ede) { result = out.ede; ex = out.example; }
      else { result = "(Chưa có trong từ điển)"; ex = ""; }
      document.getElementById("outputText").value = result;
      document.getElementById("exampleText").innerText = ex ? "Ví dụ: " + ex : "";
    }

    function handleOCR(files, isSolve = false) {
      const textContainer = isSolve ? document.getElementById("solveOutput") : document.getElementById("ocrOutput");
      textContainer.textContent = "⏳ Đang xử lý ảnh...";
      Tesseract.recognize(files[0], 'vie', { logger: m => console.log(m) }).then(({ data: { text } }) => {
        const clean = text.trim();
        if (!isSolve) {
          document.getElementById("inputText").value = clean;
          translate();
        } else {
          textContainer.innerText = "📝 Đề bài: " + clean + "\n\n🧠 Trả lời: " + solvePrompt(clean);
        }
      });
    }

    function solvePrompt(text) {
      const lower = text.toLowerCase();
      if (/tổng|cộng|phép cộng/.test(lower)) {
        const match = lower.match(/(\d+)[^\d]+(\d+)/);
        if (match) return `Kết quả là ${parseInt(match[1]) + parseInt(match[2])}.`;
      }
      if (/viết đoạn|viết văn/.test(lower) || lower.length > 30) {
        return "Gia đình là nơi ta sinh ra và lớn lên. Mọi người trong gia đình yêu thương nhau...";
      }
      return "🤖 Chưa rõ đề bài. Hãy thử nhập đề cụ thể hơn.";
    }

    function startVoice() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'vi-VN';
      recognition.onresult = function(event) {
        const spoken = event.results[0][0].transcript;
        document.getElementById("inputText").value = spoken;
        translate();
      };
      recognition.onerror = function() {
        alert("Không nhận được giọng nói. Hãy thử lại!");
      };
      recognition.start();
    }
  </script>
</body>
</html>
