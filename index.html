
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Trình Dịch Tiếng Ê-đê</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@google/generative-ai"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <style>
    @font-face {
      font-family: 'EdeFont';
      src: url('font-ede.ttf');
    }
    body {
      font-family: 'EdeFont', sans-serif;
    }
    .ai-output {
      background-color: #fef9c3;
      padding: 1rem;
      border-radius: 0.5rem;
      margin-top: 1rem;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 p-6 font-sans">

  <div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-md">
    <h1 class="text-2xl font-bold text-indigo-700 mb-4">🌐 Dịch Việt ↔ Ê-đê + Gemini AI + OCR + Phát âm</h1>

    <div class="mb-3">
      <label class="font-semibold">Nhập văn bản:</label>
      <div class="flex items-center gap-2">
        <input id="inputText" class="w-full p-2 border rounded text-black" placeholder="Ví dụ: Tôi muốn học tiếng Ê-đê" oninput="showSuggestions()">
        <button onclick="speakInput()">🔊</button>
      </div>
      <div id="suggestions" class="mt-1 flex flex-wrap gap-2 text-sm"></div>
    </div>

    <div class="flex gap-2 flex-wrap mb-4">
      <button onclick="translateBidirectional()" class="bg-blue-600 text-white px-4 py-2 rounded">↔ Dịch</button>
      <button onclick="callGemini('ví dụ')" class="bg-purple-600 text-white px-4 py-2 rounded">💡 Ví dụ</button>
      <button onclick="callGemini('đoạn văn')" class="bg-pink-600 text-white px-4 py-2 rounded">✍️ Đoạn văn</button>
      <button onclick="callGemini('giải thích')" class="bg-orange-600 text-white px-4 py-2 rounded">❓ Giải thích</button>
      <button onclick="toggleAIResult()" class="bg-gray-600 text-white px-4 py-2 rounded">👁️ Ẩn/Hiện AI</button>
      <button onclick="clearHistory()" class="bg-gray-400 text-white px-4 py-2 rounded">🗑️ Xóa lịch sử</button>
    </div>

    <div>
      <label class="font-semibold">Kết quả:</label>
      <textarea id="outputText" class="w-full p-2 border rounded bg-gray-50 h-32 text-black" readonly></textarea>
      <div id="aiResult" class="ai-output hidden text-black"></div>
    </div>

    <div class="mt-6">
      <label class="font-semibold">📷 Dịch từ ảnh:</label>
      <input type="file" id="imageInput" accept="image/*" multiple onchange="handleImageUpload()" class="mb-2">
      <div id="ocrResults" class="space-y-4"></div>
    </div>

    <div class="mt-6">
      <h3 class="font-semibold">🕘 Lịch sử:</h3>
      <ul id="historyList" class="list-disc pl-5 text-sm text-gray-700"></ul>
    </div>
  </div>

<script>
const dict = {
  "tôi": "Káo", "bạn": "Ih", "chào": "Kkuh", "tên": "Anàn", "tiếng": "Klei",
  "tiếng ê-đê": "Klei Êđê", "học": "Hriàm", "ăn": "Huà", "nấu": "Knà",
  "chơi": "Hlàp", "nước": "Ãa ]ã", "quyển sách": "Hdruäm hrà", "dạy": "Mtä",
  "muốn": "}iàng", "đi": "Nao", "nhà": "Sang", "xe": "Ãdeh", "việc": "Bruà"
};
const reverseDict = Object.fromEntries(Object.entries(dict).map(([k,v]) => [v.toLowerCase(), k]));

function translateBidirectional() {
  const input = document.getElementById("inputText").value.toLowerCase();
  const result = input.split(/\s+/).map(w => dict[w] || reverseDict[w] || `[${w}]`).join(" ");
  document.getElementById("outputText").value = result;
  saveHistory(input + " → " + result);
}

function speakInput() {
  const msg = new SpeechSynthesisUtterance(document.getElementById("inputText").value);
  speechSynthesis.speak(msg);
}

function saveHistory(entry) {
  let history = JSON.parse(localStorage.getItem("history") || "[]");
  history.unshift(entry);
  localStorage.setItem("history", JSON.stringify(history.slice(0, 10)));
  renderHistory();
}

function clearHistory() {
  localStorage.removeItem("history");
  renderHistory();
}

function renderHistory() {
  const list = document.getElementById("historyList");
  list.innerHTML = "";
  const history = JSON.parse(localStorage.getItem("history") || "[]");
  history.forEach(h => {
    const li = document.createElement("li");
    li.textContent = h;
    li.onclick = () => document.getElementById("inputText").value = h.split("→")[0].trim();
    list.appendChild(li);
  });
}

function showSuggestions() {
  const input = document.getElementById("inputText").value.toLowerCase();
  const sugDiv = document.getElementById("suggestions");
  sugDiv.innerHTML = "";
  if (!input) return;
  Object.keys(dict).concat(Object.keys(reverseDict)).forEach(w => {
    if (w.startsWith(input)) {
      const btn = document.createElement("button");
      btn.textContent = w;
      btn.className = "bg-gray-200 px-2 py-1 rounded";
      btn.onclick = () => {
        document.getElementById("inputText").value = w;
        sugDiv.innerHTML = "";
      };
      sugDiv.appendChild(btn);
    }
  });
}

async function callGemini(type) {
  const input = document.getElementById("inputText").value;
  if (!input) return alert("Nhập nội dung trước!");
  const prompts = {
    "ví dụ": `Viết ví dụ với: ${input}`,
    "đoạn văn": `Viết đoạn văn dựa trên: ${input}`,
    "giải thích": `Giải thích từ/ngữ pháp của: ${input}`
  };
  const apiKey = "AIzaSyDJ7ECoH5VagzAqaZ5QrBFS2Yx-mWbHmOg";
  const genAI = new google.generativeai.GenerativeModel({ model: "gemini-pro", apiKey });
  const result = await genAI.generateContent(prompts[type]);
  const text = await result.response.text();
  const box = document.getElementById("aiResult");
  box.textContent = "🤖 Gemini: " + text;
  box.classList.remove("hidden");
}

function toggleAIResult() {
  document.getElementById("aiResult").classList.toggle("hidden");
}

function handleImageUpload() {
  const files = document.getElementById("imageInput").files;
  const container = document.getElementById("ocrResults");
  container.innerHTML = "";
  for (const file of files) {
    const reader = new FileReader();
    reader.onload = () => {
      const img = document.createElement("img");
      img.src = reader.result;
      img.className = "max-w-xs border rounded";

      const output = document.createElement("div");
      output.textContent = "⏳ Đang nhận diện...";
      container.appendChild(img);
      container.appendChild(output);

      Tesseract.recognize(reader.result, 'vie+eng').then(res => {
        output.textContent = "📝 OCR: " + res.data.text.trim();
      });
    };
    reader.readAsDataURL(file);
  }
}

renderHistory();
</script>
</body>
</html>
