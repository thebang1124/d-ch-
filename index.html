<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ứng dụng Dịch Tiếng Êđê - Việt</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Base font for the body */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Loader spinner styles */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        /* Keyframe animation for the loader */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Flag waving animation (kept for potential future use or if user changes mind) */
        @keyframes waveFlag {
            0%, 100% {
                transform: rotateZ(0deg) translateY(0px) skewX(0deg);
            }
            25% {
                transform: rotateZ(4deg) translateY(-3px) skewX(3deg);
            }
            50% {
                transform: rotateZ(0deg) translateY(0px) skewX(0deg);
            }
            75% {
                transform: rotateZ(-4deg) translateY(3px) skewX(-3deg);
            }
        }

        .flag-waving {
            transform-origin: bottom left; /* Pivot point for waving */
            animation: waveFlag 3s ease-in-out infinite; /* Increased duration for smoother wave */
        }

        /* Dark mode specific styles */
        .dark .bg-gray-50 { background-color: #1a202c; }
        .dark .bg-white { background-color: #2d3748; }
        .dark .text-gray-800 { color: #f7fafc; }
        .dark .text-gray-600 { color: #cbd5e0; }
        .dark .text-gray-700 { color: #e2e8f0; }
        .dark .border-gray-200 { border-color: #4a5568; }
        .dark .bg-gray-50 { background-color: #4a5568; }
        .dark .border-gray-300 { border-color: #6b7280; }
        .dark .placeholder-gray-400::placeholder { color: #a0aec0; }
        .dark .bg-indigo-50 { background-color: #4338ca; } /* Darker indigo for dark mode */
        .dark .border-indigo-200 { border-color: #6366f1; }
        .dark .text-indigo-800 { color: #e0e7ff; }
        .dark .bg-purple-50 { background-color: #7c3aed; } /* Darker purple for dark mode */
        .dark .border-purple-200 { border-color: #a78bfa; }
        .dark .text-purple-800 { color: #ede9fe; }
        .dark .bg-blue-50 { background-color: #2563eb; } /* Darker blue for dark mode */
        .dark .border-blue-200 { border-color: #60a5fa; }
        .dark .text-blue-700 { color: #bfdbfe; }
        .dark .text-indigo-600 { color: #818cf8; }
        .dark .text-purple-600 { color: #c084fc; }
        .dark .text-gray-500 { color: #a0aec0; }
        .dark .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.15); }
        .dark .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.2); }
        .dark .bg-indigo-600 { background-color: #4f46e5; }
        .dark .hover\:bg-indigo-700:hover { background-color: #4338ca; }
        .dark .bg-purple-600 { background-color: #9333ea; }
        .dark .hover\:bg-purple-700:hover { background-color: #7e22ce; }
        .dark .bg-gray-400 { background-color: #6b7280; }
        .dark .bg-gray-600 { background-color: #1a202c; }
        .dark .bg-gray-700 { background-color: #2d3748; }
        .dark .text-white { color: #f7fafc; }
        .dark .border-b-indigo-500 { border-color: #6366f1; }
        .dark .border-b-gray-300 { border-color: #4a5568; }
        .dark .text-gray-400 { color: #a0aec0; }
    </style>
</head>
<body class="bg-gray-50 transition-colors duration-300">
    <div id="root"></div>

    <!-- React CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX transformation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import necessary Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, addDoc, getDocs, onSnapshot, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Expose Firebase objects globally for the Babel script to access
        window.firebase = {
            initializeApp, getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut,
            getFirestore, collection, doc, addDoc, getDocs, onSnapshot, query, serverTimestamp
        };
    </script>

    <!-- React App Code -->
    <script type="text/babel">
        // Destructure React hooks for easier use
        const { useState, useEffect, useMemo, useRef } = React;

        // MessageModal Component for displaying messages to the user (instead of alert())
        const MessageModal = ({ message, onClose }) => {
            if (!message) return null; // Don't render if no message
            return (
                <div className="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50">
                    <div className="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4 dark:bg-gray-700 dark:text-white">
                        <p className="text-lg font-semibold text-gray-800 mb-4 dark:text-white">{message}</p>
                        <button
                            onClick={onClose}
                            className="w-full px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors"
                        >
                            Đóng
                        </button>
                    </div>
                </div>
            );
        };

        // Main App Component
        function App() {
            console.log("App component rendered"); // Debugging log

            // State for dark mode toggle
            const [darkMode, setDarkMode] = useState(false);
            // State to manage active tab in the UI
            const [activeTab, setActiveTab] = useState('alphabet'); // Default tab is now 'alphabet'
            // State for displaying modal messages
            const [message, setMessage] = useState('');

            // Firebase States for database, authentication, and user info
            const [db, setDb] = useState(null);
            const [auth, setAuth] = useState(null);
            const [userId, setUserId] = useState(null);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [authLoading, setAuthLoading] = useState(true); // To show loading state during Firebase init

            // Image Translation States
            const [imageSrc, setImageSrc] = useState(null); // Base64 string of the uploaded image
            const [imageFile, setImageFile] = useState(null); // File object to get MIME type
            const [extractedText, setExtractedText] = useState(''); // Text extracted from image
            const [imageTranslation, setImageTranslation] = useState(''); // Translation of extracted text
            const [isLoadingImageTranslate, setIsLoadingImageTranslate] = useState(false); // Loading indicator for image translation
            // New states for image translation language selection
            const [sourceImageLang, setSourceImageLang] = useState('ede'); // 'ede' or 'vietnamese'
            const [targetImageLang, setTargetImageLang] = useState('vietnamese'); // 'ede' or 'vietnamese'

            // Paragraph Generation States
            const [paragraphPrompt, setParagraphPrompt] = useState(''); // User's prompt for paragraph
            const [paragraphWordCount, setParagraphWordCount] = useState(100); // Default word count for paragraph
            const [generatedParagraph, setGeneratedParagraph] = useState(''); // Generated paragraph
            const [isLoadingParagraph, setIsLoadingParagraph] = useState(false); // Loading indicator for paragraph generation

            // Explanation States
            const [explanationWord, setExplanationWord] = useState(''); // Word/concept to explain
            const [generatedExplanation, setGeneratedExplanation] = useState(''); // Generated explanation
            const [isLoadingExplanation, setIsLoadingExplanation] = useState(false); // Loading indicator for explanation generation

            // Dictionary Lookup States
            const [dictionaryWord, setDictionaryWord] = useState('');
            const [dictionaryResult, setDictionaryResult] = useState('');
            const [isLoadingDictionary, setIsLoadingDictionary] = useState(false);
            const [sourceDictionaryLang, setSourceDictionaryLang] = useState('ede');
            const [targetDictionaryLang, setTargetDictionaryLang] = useState('vietnamese');

            // Speech-to-Text States (Removed from UI, but keeping states for potential future use or debugging)
            const [speechRecognitionText, setSpeechRecognitionText] = useState(''); // Recognized text from speech
            const [isRecording, setIsRecording] = useState(false); // Recording status
            const recognitionRef = useRef(null); // Ref for SpeechRecognition object

            // Text-to-Speech States
            const [speechSynthesisText, setSpeechSynthesisText] = useState(''); // Text to be spoken
            const [isSpeaking, setIsSpeaking] = useState(false); // Speaking status
            const [voices, setVoices] = useState([]); // Available voices for TTS
            const [selectedVoice, setSelectedVoice] = useState(null); // Currently selected voice
            const synthRef = useRef(null); // Ref for SpeechSynthesis object

            // History States
            const [historyItems, setHistoryItems] = useState([]); // List of historical interactions
            const historyUnsubscribeRef = useRef(null); // Ref to unsubscribe from Firestore listener

            // Data for Êđê Alphabet Table
            const edeAlphabet = [
                { char: "A a", vietnameseSound: "a", unicode: "U+0041, U+0061", notes: "Chuẩn Latin" },
                { char: "Ă ă", vietnameseSound: "ă", unicode: "U+0102, U+0103", notes: "Latin Extended-A" },
                { char: "Â â", vietnameseSound: "â (â+o thành vần: âo- đọc là au)", unicode: "U+00C2, U+00E2", notes: "Latin-1 Supplement" },
                { char: "B b", vietnameseSound: "không có âm tương ứng", unicode: "U+0042, U+0062", notes: "Đặc trưng Êđê" },
                { char: "Ƀ ƀ", vietnameseSound: "b", unicode: "U+0042, U+0062 (kết hợp với U+0332)", notes: "Chữ b có gạch dưới, khác b trên" },
                { char: "Č č", vietnameseSound: "ch", unicode: "U+010C, U+010D", notes: "Latin Extended-A" },
                { char: "D d", vietnameseSound: "không có âm tương ứng", unicode: "U+0044, U+0064", notes: "Đặc trưng Êđê" },
                { char: "Đ đ", vietnameseSound: "d", unicode: "U+0110, U+0111", notes: "Latin Extended-A" },
                { char: "E e", vietnameseSound: "e", unicode: "U+0045, U+0065", notes: "Chuẩn Latin" },
                { char: "Ě ě", vietnameseSound: "không có âm tương ứng", unicode: "U+011A, U+011B", notes: "Latin Extended-A" },
                { char: "Ê ê", vietnameseSound: "ê", unicode: "U+00CA, U+00EA", notes: "Latin-1 Supplement" },
                { char: "Ĕ ĕ", vietnameseSound: "không có âm tương ứng", unicode: "U+1EBD, U+1EBE", notes: "Latin Extended Additional" },
                { char: "G g", vietnameseSound: "g (gh)", unicode: "U+0047, U+0067", notes: "Chuẩn Latin" },
                { char: "H h", vietnameseSound: "h", unicode: "U+0048, U+0068", notes: "Chuẩn Latin" },
                { char: "I i", vietnameseSound: "i", unicode: "U+0049, U+0069", notes: "Chuẩn Latin" },
                { char: "Ị ị", vietnameseSound: "không có âm tương ứng", unicode: "U+0049, U+0069 (kết hợp với U+0323)", notes: "Chữ i có dấu chấm dưới" },
                { char: "J j", vietnameseSound: "không có âm tương ứng", unicode: "U+004A, U+006A", notes: "Đặc trưng Êđê" },
                { char: "K k", vietnameseSound: "k (c, q)", unicode: "U+004B, U+006B", notes: "Chuẩn Latin" },
                { char: "L l", vietnameseSound: "l", unicode: "U+004C, U+006C", notes: "Chuẩn Latin" },
                { char: "M m", vietnameseSound: "m", unicode: "U+004D, U+006D", notes: "Chuẩn Latin" },
                { char: "N n", vietnameseSound: "n", unicode: "U+004E, U+006E", notes: "Chuẩn Latin" },
                { char: "Ñ ñ", vietnameseSound: "nh", unicode: "U+00D1, U+00F1", notes: "Latin-1 Supplement" },
                { char: "O o", vietnameseSound: "o", unicode: "U+004F, U+006F", notes: "Chuẩn Latin" },
                { char: "Ọ ọ", vietnameseSound: "không có âm tương ứng", unicode: "U+004F, U+006F (kết hợp với U+0323)", notes: "Chữ o có dấu chấm dưới" },
                { char: "Ô ô", vietnameseSound: "ô", unicode: "U+00D4, U+00F4", notes: "Latin-1 Supplement" },
                { char: "Ô̆ ô̆", vietnameseSound: "không có âm tương ứng", unicode: "U+1ED6, U+1ED7", notes: "Latin Extended Additional" },
                { char: "Ơ ơ", vietnameseSound: "ơ", unicode: "U+01A0, U+01A1", notes: "Latin Extended-B" },
                { char: "Ŏ ŏ", vietnameseSound: "â", unicode: "U+00D6, U+00F6", notes: "Latin-1 Supplement" },
                { char: "P p", vietnameseSound: "p", unicode: "U+0050, U+0070", notes: "Chuẩn Latin" },
                { char: "R r", vietnameseSound: "r", unicode: "U+0052, U+0072", notes: "Chuẩn Latin" },
                { char: "S s", vietnameseSound: "s (x)", unicode: "U+0053, U+0073", notes: "Chuẩn Latin" },
                { char: "T t", vietnameseSound: "t", unicode: "U+0054, U+0074", notes: "Chuẩn Latin" },
                { char: "U u", vietnameseSound: "u", unicode: "U+0055, U+0075", notes: "Chuẩn Latin" },
                { char: "Ŭ ŭ", vietnameseSound: "ŭ", unicode: "U+016C, U+016D", notes: "Latin Extended-A" },
                { char: "Ư ư", vietnameseSound: "ư", unicode: "U+01AF, U+01B0", notes: "Latin Extended-B" },
                { char: "Ư̆ ư̆", vietnameseSound: "không có âm tương ứng", unicode: "U+01AF, U+01B0 (kết hợp với U+0323)", notes: "Chữ ư có dấu chấm dưới" },
                { char: "W w", vietnameseSound: "w (v)", unicode: "U+0057, U+0077", notes: "Chuẩn Latin" },
                { char: "Y y", vietnameseSound: "y (d, gi)", unicode: "U+0059, U+0079", notes: "Chuẩn Latin" },
            ];

            // Simple hardcoded Êđê-Vietnamese dictionary for demonstration
            const edeDictionary = useMemo(() => [
                {
                ede: "Abao",
                meanings: [{ type: "dt", vietnamese: "Ốc bươu", examples: [] }]
            },
            {
                ede: "Abăn",
                meanings: [{ type: "dt", vietnamese: "Cái chăn (mền)", examples: ["Msăm abăn: Đắp chăn", "Abăn hmlei: Chăn bông"] }]
            },
            {
                ede: "Abŭ",
                meanings: [{ type: "dt", vietnamese: "Cái hũ", examples: [] }]
            },
            {
                ede: "Adei",
                meanings: [{ type: "dt", vietnamese: "Em", examples: [] }]
            },
            {
                ede: "Adě",
                meanings: [{ type: "dt", vietnamese: "Hến", examples: [] }]
            },
            {
                ede: "Adham",
                meanings: [{ type: "dt", vietnamese: "Một nhóm trong tộc người Êđê", examples: [] }]
            },
            {
                ede: "Adhan",
                meanings: [{ type: "dt", vietnamese: "Cành", examples: ["Adhan kyão: Cành cây"] }]
            },
            {
                ede: "Adhei",
                meanings: [{ type: "dt", vietnamese: "Trán", examples: ["Adhei bai: Trán rộng"] }]
            },
            {
                ede: "Adiê",
                meanings: [{ type: "dt", vietnamese: "Trời", examples: ["Adiê hjan: Trời mưa"] }]
            },
            {
                ede: "Adiê không",
                meanings: [{ type: "", vietnamese: "Nắng hạn", examples: [] }]
            },
            {
                ede: "Adiê tlam",
                meanings: [{ type: "", vietnamese: "Xế chiều", examples: [] }]
            },
            {
                ede: "Adih",
                meanings: [{ type: "đt", vietnamese: "Kia", examples: ["Sang kâo ti anôk adih: Nhà tôi chỗ kia", "Hruê aguah adih kâo đuễ hiu: Sáng ngày kia tôi đi chơi"] }]
            },
            {
                ede: "Adôk",
                meanings: [{ type: "đgt", vietnamese: "Còn", examples: ["Kâo adôk prăk: Tôi còn tiền", "Adôk hdĩp: Còn sống"] }]
            },
            {
                ede: "Adrăng",
                meanings: [{ type: "dt", vietnamese: "Rơm rạ", examples: ["Mkăm adrăng: Đống rơm"] }]
            },
            {
                ede: "Adring",
                meanings: [{ type: "dt", vietnamese: "Hiên nhà sàn", examples: ["Amĭ kâo bhu mdiê ti adring: Mẹ tôi phơi lúa ở hiên nhà sàn"] }]
            },
            {
                ede: "Adrök",
                meanings: [{ type: "dt", vietnamese: "Con cóc", examples: [] }]
            },
            {
                ede: "Aduôn",
                meanings: [{ type: "dt", vietnamese: "Bà (nội, ngoại)", examples: [] }]
            },
            {
                ede: "Adŭ",
                meanings: [
                    { type: "dt", vietnamese: "Phòng", examples: ["Adŭ pit: Phòng ngủ", "Adŭ hriăm: Phòng học"] },
                    { type: "dt", vietnamese: "Lớp", examples: ["Adŭ năm: Lớp 6", "Adŭ pluh dua: Lớp 12"] },
                    { type: "dt", vietnamese: "Cái ô", examples: ["Adŭ jũ: Ô màu đen"] },
                    { type: "dt", vietnamese: "Lớp, phòng, cái dù", examples: ["Adũ hriăm klei Êđê hmei thâo bi hgũm mguôp snăk. - Lớp học tiếng Êđê chúng tôi rất đoàn kết.", "Mỗ kâo mâo sa bẽ adũ. - Vợ tôi có một cái dù."] }
                ]
            },
            {
                ede: "Adŭ bruă",
                meanings: [{ type: "dt", vietnamese: "Văn phòng", examples: [] }]
            },
            {
                ede: "Adŭ git gai bruă kiă kriê",
                meanings: [{ type: "dt", vietnamese: "Phòng hành chính", examples: [] }]
            },
            {
                ede: "Adŭ tĭng yap",
                meanings: [{ type: "dt", vietnamese: "Phòng kế toán", examples: [] }]
            },
            {
                ede: "Adŭng",
                meanings: [{ type: "dt", vietnamese: "Mũi", examples: ["Băng adũng: Lỗ mũi"] }]
            },
            {
                ede: "Aê",
                meanings: [{ type: "dt", vietnamese: "Ông (nội, ngoại)", examples: [] }]
            },
            {
                ede: "Aê êa drao",
                meanings: [{ type: "dt", vietnamese: "Bác sĩ", examples: [] }]
            },
            {
                ede: "Aguah",
                meanings: [{ type: "trạng từ", vietnamese: "Buổi sáng", examples: ["Aguah ưm: Sáng sớm", "Aguah mgi: Sáng mai", "Aguah mbruê: Sáng hôm qua"] }]
            },
            {
                ede: "Ai",
                meanings: [{ type: "dt", vietnamese: "Sức", examples: ["Ai ktang: Sức mạnh"] }]
            },
            {
                ede: "Ajĭk",
                meanings: [{ type: "dt", vietnamese: "Ếch", examples: [] }]
            },
            {
                ede: "Ak",
                meanings: [{ type: "dt", vietnamese: "Con quạ", examples: ["Jũ msě si ak: Đen như quạ"] }]
            },
            {
                ede: "Akăt",
                meanings: [{ type: "dt", vietnamese: "Bụi (khóm)", examples: ["Akăt kram: Bụi tre"] }]
            },
            {
                ede: "Akâo",
                meanings: [{ type: "đgt", vietnamese: "Xin", examples: ["Akâo prăk: Xin tiền", "Akâo êa mnăm: Xin nước uống"] }]
            },
            {
                ede: "Ala",
                meanings: [{ type: "dt", vietnamese: "Con rắn", examples: ["Ala knăl: Rắn giun", "Ala mtah: Rắn lục"] }]
            },
            {
                ede: "Alah",
                meanings: [{ type: "tt", vietnamese: "Lười biếng", examples: ["Alah mă bruă: Lười làm việc"] }]
            },
            {
                ede: "Ală",
                meanings: [{ type: "dt", vietnamese: "Mắt", examples: ["Pĩt ală: Nhắm mắt"] }]
            },
            {
                ede: "Ama",
                meanings: [{ type: "dt", vietnamese: "Bố (cha)", examples: [] }]
            },
            {
                ede: "Amai",
                meanings: [{ type: "dt", vietnamese: "Chị", examples: [] }]
            },
            {
                ede: "Amâo",
                meanings: [{ type: "pht", vietnamese: "Không", examples: ["Amâo mâo: Không có"] }]
            },
            {
                ede: "Amĭ",
                meanings: [{ type: "dt", vietnamese: "Mẹ (má)", examples: [] }]
            },
            {
                ede: "Ana",
                meanings: [{ type: "dt", vietnamese: "Cây; giống cái (Chỉ động vật)", examples: ["Hlăm hma, awa pla lu ana boh kroh. - Trong rẫy, bác trồng nhiều loại cây ăn trái.", "Ɇmô ana sang aê mrâo mdai. - Bò cái nhà ông mới đẻ."] }]
            },
            {
                ede: "Anak",
                meanings: [{ type: "dt", vietnamese: "Con (người)", examples: [] }]
            },
            {
                ede: "Anăn",
                meanings: [
                    { type: "dt", vietnamese: "Tên; (đt): Đó, đấy", examples: [] },
                    { type: "dt", vietnamese: "Tên; đó, ấy, đấy", examples: ["Mõng anei ko anăn amão kbui ôh : Từ đây đên đó không xa.", "Siam leh anăn : Đẹp rồi đó."] }
                ]
            },
            {
                ede: "Anei",
                meanings: [{ type: "đt", vietnamese: "Đây", examples: ["Kâo mă bruă ti anei: Tôi làm việc ở đây"] }]
            },
            {
                ede: "Anôk",
                meanings: [{ type: "dt", vietnamese: "Nơi, chỗ, vị trí", examples: ["Djõ anôk: Đúng vị trí"] }]
            },
            {
                ede: "Ao",
                meanings: [{ type: "dt", vietnamese: "Áo", examples: ["Ao kỗ: Áo trắng", "Ao hjan: Áo mưa"] }]
            },
            {
                ede: "Arăng",
                meanings: [{ type: "đt", vietnamese: "Người ta", examples: ["Kâo dlăng arăng bị lông đi čữ. Tôi xem người ta thi leo núi."] }]
            },
            {
                ede: "Asăr",
                meanings: [{ type: "dt", vietnamese: "Hạt, hột", examples: ["Asăr mdiê: Hạt lúa. Boh čên anei lu asăr. - Quả chanh này nhiều hột. Mdiê bi asăr êdi. - Lúa rất chắc hạt."] }]
            },
            {
                ede: "Asâo",
                meanings: [{ type: "dt", vietnamese: "Con chó", examples: [] }]
            },
            {
                ede: "Awa",
                meanings: [{ type: "dt", vietnamese: "Bác (anh, chị của bố)", examples: [] }]
            },
            {
                ede: "Ayong",
                meanings: [{ type: "dt", vietnamese: "Anh", examples: [] }]
            },
            {
                ede: "Băng",
                meanings: [
                    { type: "đgt", vietnamese: "Ăn (thức ăn nói chung), cháy, bén", examples: [] },
                    { type: "đgt", vietnamese: "Ăn, cháy, bén", examples: ["Kâo čiăng băng boh truôl. - Tôi muốn ăn quả ổi.", "Yan bhang bị răng hệ dliê hui pui bỡng. - Mùa hè phải phòng chống cháy rừng.", "Kgă anei băng snăk. - Cái rựa này rất bén."] },
                    { type: "đgt", vietnamese: "Ăn (bánh trái và thức ăn nói chung)", examples: [] }
                ]
            },
            {
                ede: "Blei",
                meanings: [{ type: "đgt", vietnamese: "Mua", examples: ["Amai blei dua aruăt klei mah. Chị mua hai sợi dây chuyền vàng."] }]
            },
            {
                ede: "Blŭ",
                meanings: [{ type: "đgt", vietnamese: "Nói", examples: [] }]
            },
            {
                ede: "Boh",
                meanings: [
                    { type: "dt", vietnamese: "Quả, trái", examples: ["Boh suai: quả xoài", "boh kruễ: trái cam"] },
                    { type: "dt", vietnamese: "Trứng", examples: ["boh mnũ: trứng gà"] },
                    { type: "đt", vietnamese: "Giặt", examples: ["Boh chum ao: giặt quần áo"] },
                    { type: "tt", vietnamese: "Cái xấu", examples: ["Boh jhat: cái xấu"] },
                    { type: "tl", vietnamese: "Cái, chiếc", examples: ["Dua boh kčok: hai cái ly", "Sa boh sang: một ngôi nhà", "Êma boh čar: năm tỉnh", "Pă asăr boh kruễ: bốn quả cam"] },
                    { type: "dt", vietnamese: "Quả, trái, giặt, chiếc, hòn (dùng đếm đồ vật)", examples: ["Kão khắp bỡng boh suai mmih. - Tôi thích ăn quả xoài ngọt.", "Sang kâo mâo dua boh êdeh pơ phút. - Nhà tôi có hai chiếc xe máy.", "Mỗ kâo dôk boh chum ao. - Vợ tôi đang giặt quần áo."] }
                ]
            },
            {
                ede: "Bruă",
                meanings: [{ type: "dt", vietnamese: "Việc, công việc", examples: ["Mă bruă: làm việc", "Tơ nao mă bruă, kâo khăng đi êdeh pơ phút. - Khi đi làm, tôi thường đi xe máy."] }]
            },
            {
                ede: "Buôn",
                meanings: [{ type: "dt", vietnamese: "Làng, buôn", examples: ["Hlăm buôn anei, mão lu boh gõ esei kjăp băng huă. Trong buôn này, có nhiều con trâu ăn khỏe."] }]
            },
            {
                ede: "Čih",
                meanings: [
                    { type: "đgt", vietnamese: "Viết", examples: [] },
                    { type: "đgt", vietnamese: "Viết", examples: ["Kâo hriăm čih klei Êđê: Tôi học viết tiếng Êđê."] }
                ]
            },
            {
                ede: "Dlăng",
                meanings: [{ type: "đgt", vietnamese: "Đọc, xem, nhìn", examples: [] }]
            },
            {
                ede: "Djam",
                meanings: [
                    { type: "dt", vietnamese: "Rau, canh", examples: [] },
                    { type: "dt", vietnamese: "Rau; canh", examples: ["Sang cơ chỉ lu mta djam. - Chợ bán nhiều loại rau.", "Ami tük djam djiă. - Mẹ nấu canh rau ngót."] }
                ]
            },
            {
                ede: "Djă",
                meanings: [{ type: "đgt", vietnamese: "Cầm, giữ", examples: ["Anak kâo djă sa bẽ giê čih. - Con tôi cầm một cây bút.", "Ayong djă êdeh wai ko adei pom đa. - Anh giữ xe đạp cho em bơm với."] }]
            },
            {
                ede: "Drei",
                meanings: [
                    { type: "đt", vietnamese: "Chúng ta, ta; (tl) con (dùng đếm con vật)", examples: [] },
                    { type: "đt", vietnamese: "Chúng ta, ta, số đếm (con vật)", examples: ["Drei amão dưi čuh dliê pliă plia ôh. - Chúng ta không được đốt rừng bừa bãi.", "Lăn čar drei mdrōng leh anăn siam. - Đất nước ta giàu và đẹp.", "Sang aduôn rông dua drei miêu. - Nhà bà nuôi hai con mèo."] }
                ]
            },
            {
                ede: "Êa",
                meanings: [{ type: "dt", vietnamese: "Nước", examples: [] }]
            },
            {
                ede: "Êdeh",
                meanings: [{ type: "dt", vietnamese: "Xe", examples: ["Tơ nao mă bruă, kâo khăng đi êdeh pơ phút. Khi đi làm, tôi thường đi xe máy."] }]
            },
            {
                ede: "Êmô",
                meanings: [{ type: "dt", vietnamese: "Con bò", examples: [] }]
            },
            {
                ede: "Êsei",
                meanings: [{ type: "dt", vietnamese: "Cơm", examples: [] }]
            },
            {
                ede: "Hriăm",
                meanings: [{ type: "đgt", vietnamese: "Học", examples: [] }]
            },
            {
                ede: "Hruê",
                meanings: [{ type: "dt", vietnamese: "Ngày", examples: ["Hruê mdei, kâo hiu chưn hồng bằng gặp. Ngày nghỉ, tôi đi chơi với bạn."] }]
            },
            {
                ede: "Huă",
                meanings: [{ type: "đgt", vietnamese: "Ăn (cơm)", examples: [] }]
            },
            {
                ede: "Ih",
                meanings: [{ type: "đt", vietnamese: "Anh, chị, bạn (ngôi thứ 2 số ít)", examples: [] }]
            },
            {
                ede: "Jăk",
                meanings: [
                    { type: "tt", vietnamese: "Tốt, ngon", examples: [] },
                    { type: "tt", vietnamese: "Tốt, ngon", examples: ["Kan kruah bong jak snăk. - Cá lóc ăn rất ngon. Hoặc: Hmưi kơ gặp pīt jăk hõ. - Chúc bạn ngủ ngon nhé.", "Gặp anăn mâo knhuah ai tiê jăk êdi. - Bạn ấy có đức tính rất tốt."] }
                ]
            },
            {
                ede: "Kâo",
                meanings: [{ type: "đt", vietnamese: "Tôi (ngôi thứ nhất số ít)", examples: ["Kâo dlăng arăng bị lông đi čữ. Tôi xem người ta thi leo núi."] }]
            },
            {
                ede: "Kan",
                meanings: [{ type: "dt", vietnamese: "Cá", examples: [] }]
            },
            {
                ede: "Khăp",
                meanings: [
                    { type: "đgt", vietnamese: "Thích, yêu", examples: [] },
                    { type: "đgt", vietnamese: "Thích, yêu", examples: ["Kão khăp hriăm klei Êđê. - Tôi thích học tiếng Êđê.", "Kão khăp kơ mỗ anak kâo. - Tôi yêu vợ con tôi."] }
                ]
            },
            {
                ede: "Klei",
                meanings: [
                    { type: "dt", vietnamese: "Tiếng, lời, sự việc, dây", examples: ["Amai blei dua aruăt klei mah. Chị mua hai sợi dây chuyền vàng."] },
                    { type: "dt", vietnamese: "Tiếng, dây, đào, sự việc, bài, điều...", examples: ["Kão khặp hriăm klei Êđê. - Tôi thích học tiếng Êđê.", "Phung hđeh hlăp kdăt klei. - Bọn trẻ chơi nhảy dây.", "Ama kâo dôk klei băng êa. - Bố tôi đang đào giếng."] }
                ]
            },
            {
                ede: "Kphê",
                meanings: [{ type: "dt", vietnamese: "Cà phê", examples: ["Čar Dak Lak pla lu kphê. Tỉnh Đắk Lắk trồng nhiều cà phê."] }]
            },
            {
                ede: "Kyâo",
                meanings: [{ type: "dt", vietnamese: "Gỗ, cây", examples: ["Sang kâo ngã hõng kyâo. Nhà tôi làm bằng gỗ."] }]
            },
            {
                ede: "Mă",
                meanings: [{ type: "đgt", vietnamese: "Làm, lấy, bắt", examples: [] }]
            },
            {
                ede: "Mâo",
                meanings: [
                    { type: "đgt", vietnamese: "Có, được", examples: [] },
                    { type: "đgt", vietnamese: "Có, được", examples: ["Kâo wah mâo êma drei kan bư. - Tôi câu được 5 con cá lóc.", "Kão mâo dua blah ao mrão. - Tôi có 2 cái áo mới."] }
                ]
            },
            {
                ede: "Mdiê",
                meanings: [{ type: "dt", vietnamese: "Lúa", examples: [] }]
            },
            {
                ede: "Mlan",
                meanings: [
                    { type: "dt", vietnamese: "Tháng, trăng", examples: [] },
                    { type: "dt", vietnamese: "Tháng, trăng", examples: ["Mlan pluh sa anei, adŭ klei Êđê hmei bi lông jih gưl hriăm. - Tháng 11 này, lớp tiếng Êđê chúng tôi thi hết khoá học.", "Mlan pŭr mngač msẽ si yang hruê. - Trăng rằm sáng như ban ngày."] }
                ]
            },
            {
                ede: "Mnăm",
                meanings: [{ type: "đgt", vietnamese: "Uống", examples: [] }]
            },
            {
                ede: "Mniê",
                meanings: [{ type: "dt", vietnamese: "Phụ nữ, con gái", examples: [] }]
            },
            {
                ede: "Mnuih",
                meanings: [{ type: "dt", vietnamese: "Người", examples: [] }]
            },
            {
                ede: "Mnŭ",
                meanings: [{ type: "dt", vietnamese: "Con gà", examples: [] }]
            },
            {
                ede: "Nao",
                meanings: [{ type: "đgt", vietnamese: "Đi", examples: [] }]
            },
            {
                ede: "Ñu",
                meanings: [{ type: "đt", vietnamese: "Nó, ông ấy, bà ấy (ngôi thứ 3 số ít)", examples: [] }]
            },
            {
                ede: "Pla",
                meanings: [{ type: "đgt", vietnamese: "Trồng, cấy", examples: ["Hlăm hma, awa pla lu ana boh kroh. Trong rẫy, bác trồng nhiều loại cây ăn trái."] }]
            },
            {
                ede: "Prăk",
                meanings: [{ type: "dt", vietnamese: "Tiền, bạc", examples: [] }]
            },
            {
                ede: "Ruă",
                meanings: [{ type: "đgt", vietnamese: "Đau, ốm", examples: ["Amũ kâo ruă aruăt ariêng. Mẹ tôi đau gân cốt."] }]
            },
            {
                ede: "Sang",
                meanings: [{ type: "dt", vietnamese: "Nhà", examples: ["Sang kâo ngã hõng kyâo. Nhà tôi làm bằng gỗ."] }]
            },
            {
                ede: "Siam",
                meanings: [{ type: "tt", vietnamese: "Đẹp", examples: [] }]
            },
            {
                ede: "Thâo",
                meanings: [{ type: "đgt", vietnamese: "Biết", examples: [] }]
            },
            {
                ede: "Thuôn",
                meanings: [{ type: "dt", vietnamese: "Năm, tuổi", examples: [] }]
            },
            {
                ede: "ŭn",
                meanings: [{ type: "dt", vietnamese: "Lợn, heo", examples: [] }]
            },
            {
                ede: "Aruăt",
                meanings: [
                    { type: "dt", vietnamese: "Gân, sợi", examples: ["Amũ kâo ruă aruăt ariêng. Mẹ tôi đau gân cốt. Amai blei dua aruăt klei mah. Chị mua hai sợi dây chuyền vàng."] },
                    { type: "tl", vietnamese: "Sợi", examples: ["Sợi: dùng cho đổ vật có hình sợi: sợi dây, sợi tóc..."] }
                ]
            },
            {
                ede: "Čar",
                meanings: [
                    { type: "dt", vietnamese: "Tỉnh, chẻ", examples: ["Čar Dak Lak pla lu kphê. Tỉnh Đắk Lắk trồng nhiều cà phê. Aê dôk čar mnũng. Ông đang chẻ lạt."] },
                    { type: "đgt", vietnamese: "Chẻ", examples: ["Aê dôk čar mnũng: Ông đang chẻ lạt."] }
                ]
            },
            {
                ede: "Đi",
                meanings: [
                    { type: "đgt", vietnamese: "Leo, trèo, cưỡi, đi", examples: ["Kâo dlăng arăng bị lông đi čữ. Tôi xem người ta thi leo núi. Tơ nao mă bruă, kâo khăng đi êdeh pơ phút. Khi đi làm, tôi thường đi xe máy. Hruê mdei, kâo hiu chưn hồng bằng gặp. Ngày nghỉ, tôi đi chơi với bạn."] },
                    { type: "đgt", vietnamese: "Leo, trèo, cưỡi, đi", examples: ["Kâo dlăng arăng bị lông [bi läng] đi čữ. - Tôi xem người ta thi leo núi.", "Tơ nao mă bruă, kâo khăng đi êdeh pơ phút. - Khi đi làm, tôi thường đi xe máy.", "Hruê mdei, kâo hiu chưn [ho\\ng] bằng gặp. - Ngày nghỉ, tôi đi chơi với ban."] }
                ]
            },
            {
                ede: "Yuăr",
                meanings: [{ type: "dt", vietnamese: "Cây canh kina rễ", examples: [] }]
            },
            {
                ede: "Yuăt",
                meanings: [{ type: "đgt", vietnamese: "Bám", examples: ["Yuät ti dhan kyáo hrut asei â^ kå dläng: Bám cành cây âu người lăn."] }]
            },
            {
                ede: "Yut yat",
                meanings: [{ type: "tt", vietnamese: "Đung đưa", examples: [] }]
            },
            {
                ede: "Yŭ",
                meanings: [{ type: "dt", vietnamese: "(Hướng) Tây", examples: ["."] }]
            },
            {
                ede: "Yŭ ngŏ",
                meanings: [{ type: "dt", vietnamese: "Phương hướng", examples: [""] }]
            },
            {
                ede: "Yŭk",
                meanings: [{ type: "dt", vietnamese: "Ổi", examples: ["Yŭk ]hum: Ổi quấn."] }]
            },
            {
                ede: "Yŭm",
                meanings: [{ type: "tt", vietnamese: "Mãn (nhiều), đông", examples: ["Yŭm anak: Mãn con", "Yŭm mse si hdăm: Đông như kiến."] }]
            },
            {
                ede: "Yŭn",
                meanings: [{ type: "đgt", vietnamese: "Rung", examples: [] }]
            },
            {
                ede: "Yŭng jing",
                meanings: [{ type: "đgt", vietnamese: "Đứng sững", examples: [] }]
            },
            {
                ede: "Yŭr",
                meanings: [{ type: "dt", vietnamese: "Dãi", examples: ["Yŭr knga: Dãi tai."] }]
            },
            {
                ede: "Yŭr tluôn",
                meanings: [{ type: "dt", vietnamese: "Mỏng, ít", examples: [] }]
            },
            {
                ede: "yưh yưp",
                meanings: [{ type: "tt", vietnamese: "1. Chậm chạp", examples: ["Ãbat yæh yæp: Đi chậm chạp.", "2. Luôn bại. Ai tiã yæh yæp: Tinh thần luôn bại."] }]
            },
            {
                ede: "Buă",
                meanings: [{ type: "đgt", vietnamese: "Đuổi, xua", examples: ["Buă mnŭ: Đuổi gà."] }]
            },
            {
                ede: "Dliê",
                meanings: [{ type: "dt", vietnamese: "Rừng", examples: ["Kmrỡng dliê: Trong rừng."] }]
            },
            {
                ede: "Êbat",
                meanings: [{ type: "đgt", vietnamese: "Đi bộ", examples: ["Kâo êbat nao sang hră: Tôi đi bộ đến trường."] }]
            },
            {
                ede: "Hjan",
                meanings: [{ type: "dt", vietnamese: "Mưa", examples: ["Hjan prōng: Mưa lớn."] }]
            },
            {
                ede: "Kông",
                meanings: [{ type: "dt", vietnamese: "Vòng (trang sức)", examples: ["Buh kông: Đeo vòng."] }]
            },
            {
                ede: "Mgi",
                meanings: [{ type: "trạng từ", vietnamese: "Ngày mai", examples: ["Aguah mgi: Sáng mai."] }]
            },
            {
                ede: "Mngač",
                meanings: [{ type: "tt", vietnamese: "Sáng, trong lành", examples: ["Pui mngač: Ánh sáng."] }]
            },
            {
                ede: "Mnŭng",
                meanings: [{ type: "dt", vietnamese: "Rau, món ăn", examples: ["Djam mnŭng: Rau ăn."] }]
            },
            {
                ede: "Pĭt",
                meanings: [{ type: "đgt", vietnamese: "Ngủ, nhắm (mắt)", examples: ["Pĩt ală: Nhắm mắt."] }]
            },
            {
                ede: "Tlam",
                meanings: [{ type: "dt", vietnamese: "Buổi tối", examples: ["Tlam anei: Tối nay."] }]
            },
            {
                ede: "Ung",
                meanings: [{ type: "dt", vietnamese: "Chồng", examples: ["Ung kâo: Chồng tôi."] }]
            },
            {
                ede: "War",
                meanings: [
                    { type: "dt", vietnamese: "Vườn, chuồng", examples: [] },
                    { type: "dt", vietnamese: "Chuồng, vườn", examples: ["Hlăm war, ama kâo pla djam bei. - Trong vườn, bố tôi trồng rau cải.", "Awa kão dôk ngă war ũn. - Bác tôi đang làm chuồng heo."] }
                ]
            },
            {
                ede: "Yŭ",
                meanings: [{ type: "dt", vietnamese: "Phía Tây", examples: ["Yang hruê lẽ tĩng yũ: Mặt trời lặn phía Tây."] }]
            },
            {
                ede: "Hăng",
                meanings: [{ type: "lt", vietnamese: "Bằng, với", examples: ["Hruê mdei, kâo hiu chưn [ho\\ng] bằng gặp. - Ngày nghỉ, tôi đi chơi với ban.", "Sang kâo ngã [ho\\ng] kyâo. - Nhà tôi làm bằng gỗ."] }]
            },
            {
                ede: "Bĕ",
                meanings: [{ type: "tl", vietnamese: "Cái, chỉ số cây", examples: ["Anak blei pluh bĕ giê pioh hriăm yap. - Con mua mười cái que để tập đếm.", "Kão blei dua bẽ giê čih. - Tôi mua hai cây bút viết.", "Hlăm war, ama pla êma bě ana boh bor. - Trong vườn, bố trồng năm cây bơ."] }]
            },
            {
                ede: "Ƀlĕ",
                meanings: [{ type: "đgt", vietnamese: "Chảy, mọc, trổ", examples: ["Êa blẽ tỉ dlông công čữ. - Nước chảy từ đỉnh núi.", "Yang hruê mrâo blẽ. - Mặt trời mới mọc.", "Mdiê lỗ hlăk blẽ. - Lúa ruộng đang trổ bông."] }]
            },
            {
                ede: "Buh",
                meanings: [
                    { type: "đgt", vietnamese: "Đeo (ở tay, chân)", examples: ["Kão buh kông. - Tôi đeo vòng."] },
                    { type: "đgt", vietnamese: "Tria (lúa)", examples: ["Hruê anei, hmei nao buh mdiê kơ hma. - Hôm nay, chúng tôi đi trĩa lúa ở rẫy."] },
                    { type: "đgt", vietnamese: "Đeo (vòng (kông))", examples: [] }
                ]
            },
            {
                ede: "Čim",
                meanings: [{ type: "dt", vietnamese: "Thịt, chim", examples: ["Kão khặp bỡng čim kđeh hin ko čim prai. - Tôi thích ăn thịt nạc hơn thịt mỡ.", "Sang kâo rông lu čim ktrão. - Nhà tôi nuôi nhiều chim bồ câu."] }]
            },
            {
                ede: "Čoh",
                meanings: [{ type: "đgt", vietnamese: "Mổ, cắn, cuốc", examples: ["Mnu čoh mdiê. - Gà mổ lúa.", "Ala čoh jỡng êmô. - Rắn cắn chân bò."] }]
            },
            {
                ede: "Djă",
                meanings: [{ type: "đgt", vietnamese: "Cầm, giữ", examples: ["Anak kâo djă sa bẽ giê čih. - Con tôi cầm một cây bút.", "Ayong djă êdeh wai ko adei pom đa. - Anh giữ xe đạp cho em bơm với."] }]
            },
            {
                ede: "Leh",
                meanings: [{ type: "pht", vietnamese: "Đã, rồi, xong", examples: ["Kão huā trei leh. - Tôi đã ăn no.", "Phung hmei ngă leh klei hriăm. - Chúng tôi làm xong bài tập rồi."] }]
            },
            {
                ede: "Msăm",
                meanings: [
                    { type: "đgt", vietnamese: "Đắp (chăn)", examples: ["Adiê ê-ăt, kâo pīt msăm abăn. - Trời lạnh, tôi ngủ đắp chăn."] },
                    { type: "tt", vietnamese: "Chua", examples: ["Boh kruễ anei msăm êdi. - Quả cam này chua lắm."] }
                ]
            },
            {
                ede: "Êluih",
                meanings: [{ type: "tt", vietnamese: "Rẻ; dễ", examples: ["Djam mtam chí êlưih snăk. - Rau bán rất rẻ.", "Klei ting anei êlrih thâo săng. - Phép tính này dễ hiểu."] }]
            },
            {
                ede: "Mta",
                meanings: [{ type: "dt", vietnamese: "Lưỡi (dao, gươm); thứ, loại, món", examples: ["Dhõng anei mta bi k'hưt êdi. - Con dao này lưỡi sắc bén lắm.", "Hlăm sang cơ chỉ lu mta boh kroh. - Trong chợ bán nhiều thứ trái cây."] }]
            },
            {
                ede: "Tal",
                meanings: [{ type: "đgt", vietnamese: "Xẻ, thứ", examples: ["Ama kâo tal čim ũn. - Bố tôi xẻ thịt heo.", "Kâo anak tal dua hlăm gõ êsei. - Tôi con thứ hai trong gia đình."] }]
            },
            {
                ede: "Khŏk",
                meanings: [{ type: "đgt", vietnamese: "Gõ, cụng", examples: ["Lông khŏk lăng čing anei. - Anh gõ thử chiêng này.", "Drei mnăm kpiê khăng bị khōk kčok. - Chúng ta uống rượu thường cụng ly."] }]
            },
            {
                ede: "Bi",
                meanings: [{ type: "pht", vietnamese: "Còn, phải", examples: ["Kão nao mă bruă bi anak kâo dê nao sang hră. - Tôi đi làm còn con tôi thì đi học.", "Drei bi gir ktür hriăm hẽ klei Êđê. - Chúng ta phải cố gắng học tiếng Êđê."] }]
            },
            {
                ede: "Dôk",
                meanings: [
                    { type: "đgt", vietnamese: "Ở, đang, ngồi", examples: [] },
                    { type: "đgt", vietnamese: "Ở, đang, ngồi, lấy (vợ, chồng)", examples: ["Kảo dôk tỉ sang. - Tôi ở nhà.", "Kảo đôk boh chum ao. - Tôi đang giặt quần áo.", "Adei kão dôk mỗ leh. - Em tôi lấy vợ rồi. Hoặc Adei kão dôk ung leh. - Em tôi lấy chồng rồi."] }
                ]
            },
            {
                ede: "Kkiêng",
                meanings: [
                    { type: "đgt", vietnamese: "Sinh đẻ (người)", examples: [] },
                    { type: "đgt", vietnamese: "Sinh đẻ (người), khuỷu tay, góc", examples: ["Amai kảo kkiêng thũn sa êbảo dua păn êtuh năm pluh. - Chị tôi sinh năm 1960.", "Mỗ kão mrảo kkiêng. - Vợ tôi mới đẻ.", "Kảo rua kkiêng kngan. - Tôi đau khuỷu tay.", "Sang amai kảo ti kkiêng buôn prōng. - Nhà chị tôi ở góc phố."] }
                ]
            },
            {
                ede: "Khua",
                meanings: [
                    { type: "dt", vietnamese: "Trường", examples: [] },
                    { type: "dt", vietnamese: "Già, người lãnh đạo", examples: ["Ama kâo khua thũn leh. - Bố tôi già rồi.", "Hruê kjuh mdih kâo nao chưn sang khua buôn. - Chủ nhật vừa qua, tôi đi chơi nhà trưởng buôn."] }
                ]
            },
            {
                ede: "Lŏ",
                meanings: [{ type: "dt", vietnamese: "Ruộng, nữa, lại", examples: ["Awa kâo nao ngã lõ. - Bác tôi đi làm ruộng.", "Ayōng lõ čiăng băng boh suai mmih mỡ? - Anh muốn ăn xoài ngọt nữa không?"] }]
            },
            {
                ede: "Djŏ",
                meanings: [{ type: "tt", vietnamese: "Trúng, đúng", examples: ["Kão mnah djō anôk čuăn leh. - Tôi đã bắn trúng mục tiêu.", "Anak kâo ngã djõ leh klei ting. - Con tôi làm bài toán đúng rồi."] }]
            },
            {
                ede: "Čô",
                meanings: [{ type: "dt", vietnamese: "Cháu (nội, ngoại); gội; từ đếm số người, dra", examples: ["Ami kâo mâo pã cô cô. - Mẹ tôi có 4 đứa cháu.", "Grăp hruê kâo khăng cô kõ. - Hằng ngày, tôi thường gội đầu.", "Sang kâo mâo pã cô mnuih. - Nhà tôi có 4 người."] }]
            },
            {
                ede: "Mtah",
                meanings: [{ type: "tt", vietnamese: "Xanh, tươi, sống", examples: ["Kão mâo sa blah ao mtah. - Tôi có một cái áo màu xanh.", "Mỗ kâo nao sang čơ blei sa ki kan mtah. - Vợ tôi đi chợ mua một ký cá tươi.", "Anak kâo knă êsei dôk mtah. - Con tôi nấu cơm còn sống."] }]
            },
            {
                ede: "Khăng",
                meanings: [{ type: "tt", vietnamese: "Cứng, thường", examples: ["Boh tâo anei khăng. - Cục đá này cứng.", "Kâo khăng nao mă bruă kjuh mmông. - Tôi thường đi làm lúc 7 giờ."] }]
            },
            {
                ede: "Hlâo",
                meanings: [{ type: "dt", vietnamese: "Chày, đôi", examples: ["Ama kâo blei sa bẽ hlâo. - Bố tôi mua 1 cái chày.", "Kâo blei sa hlâo hdruôm jỡng. - Tôi mua 1 đôi giày."] }]
            },
            {
                ede: "Krah",
                meanings: [{ type: "dt", vietnamese: "Nhẫn, đẽo", examples: ["Kâo čut sa aruăt krah. - Tôi đeo một chiếc nhẫn.", "Awa krah kmeh ngă sang. - Bác đẽo cột để làm nhà."] }]
            },
            {
                ede: "Knô",
                meanings: [{ type: "dt", vietnamese: "Đực; trống", examples: ["Sang awa rông sa drei êmô knô. - Nhà bác nuôi một con bò đực.", "Grăp aguah, mnũ knô khăng kdjỗ. - Mỗi buổi sáng, gà trống thường gáy."] }]
            },
            {
                ede: "Čut",
                meanings: [
                    { type: "đgt", vietnamese: "Đeo, mặc", examples: [] },
                    { type: "đgt", vietnamese: "Đeo, mặc, cắm (cờ, hoa,...)", examples: ["Kâo bi čut krah kơ bằng khăp. - Tôi đeo nhẫn cho người yêu.", "Anak kâo čut chum jũ. - Con tôi mặc quần màu đen.", "Mỗ kâo čut mnga hlăm tõ. - Vợ tôi cắm hoa trong bình (lọ)."] },
                    { type: "đgt", vietnamese: "Đeo (nhẫn (krah), bông tai (buê))", examples: [] },
                    { type: "đgt", vietnamese: "Đeo (giày (hdruôm jõng), dép (jep))", examples: [] }
                ]
            },
            {
                ede: "Pŏk",
                meanings: [{ type: "đgt", vietnamese: "Mở, số đếm (vở sách, trang, tờ...)", examples: ["Kão põk băng bhã čiăng kơ mngač. - Tôi mở cửa cho thoáng.", "Hdruôm hră hriăm klei Êđê mâo dua êtuh êma pluh năm põk. - Quyển sách học tiếng Êđê có 256 trang.", "Kão blei ko anak kâo pluh põk hdruôm m'ar. - Tôi mua cho con tôi 10 quyển vở.", "Kão mão êma pluh põk prăk êma êtuh. - Tôi có 50 tờ 500.000 đồng."] }]
            },
            {
                ede: "Blah",
                meanings: [{ type: "đgt", vietnamese: "Chẻ, bổ, số đếm (màn, chăn, chiếu,...)", examples: ["Aduôn kâo dôk blah djuh. - Bà tôi đang chẻ củi.", "Ami kâo blah mkai bỡng. - Mẹ tôi bổ dưa hấu để ăn.", "Kão mrâo kčoh dua blah chum. - Tôi mới may 2 cái quần.", "Hoặc: Amai blei tlão blah mũng leh anăn dua blah anuê. - Chị mua 3 cái mùng và 2 chiếc chiếu."] }]
            },
            {
                ede: "Phi",
                meanings: [{ type: "dt", vietnamese: "Mật, đắng", examples: ["Phí kgão tram kpiê. - Mật gấu ngâm rượu.", "Kảo khắp bỡng djam trong phi. - Tôi thích ăn cà đắng. Hoặc: Êa drao anei mnăm phĩ snak. - Viên thuốc này uống rất đắng."] }]
            },
            {
                ede: "Kram",
                meanings: [{ type: "dt", vietnamese: "Tre, chim, dăm", examples: ["Sang hmei pla sa phún kram. - Nhà chúng tôi trồng một gốc tre. Hoặc: Amí kão nao dāk ēbüng kram. - Mẹ tôi đi hái (bè) măng tre.", "Mram kram gũ ĉa. - Chiếc thuyền chìm xuống dưới nước."] }]
            },
            {
                ede: "Kčoh",
                meanings: [
                    { type: "đgt", vietnamese: "May", examples: ["Mỗ kâo kčoh ao: Vợ tôi may áo."] },
                    { type: "đgt", vietnamese: "Băm, may", examples: ["Ami kâo dôk kčoh mnỡng ko ăn. - Mẹ tôi đang băm rau cho heo.", "Kão mrão kčoh sa blah ao kỗ. - Tôi mới may một cái áo màu trắng."] }
                ]
            },
            {
                ede: "Diăng",
                meanings: [{ type: "đgt", vietnamese: "Đọc, xem, nhìn, trông...", examples: ["Kão dôk dlăng čưng boh. - Tôi đang xem đá bóng.", "Anak kâo dôk dlăng hră. - Con tôi đang đọc sách.", "Kão dlăng kơ adei adih kbät mniê êdi. - Tôi nhìn em kia rất xinh."] }]
            },
            {
                ede: "Mbang",
                meanings: [{ type: "đgt", vietnamese: "Dịch thuật, giảng", examples: ["Grăp tlam, kâo mblang klei ting ko anak kâo. - Mỗi tối, tôi giảng bài toán cho con tôi.", "Kão hriăm mblang klei Êđê. - Tôi tập dịch tiếng Êđê."] }]
            },
            {
                ede: "Jak",
                meanings: [{ type: "đgt", vietnamese: "Mời, rủ", examples: ["Kâo jak bĩng gặp hriê chưn sang kâo. - Tôi rủ bạn bè đến nhà tôi chơi.", "Kâo jak Y- Lan nao mnăm kphê. - Tôi mời Y- Lan đi uống cà phê."] }]
            },
            {
                ede: "Mdah",
                meanings: [{ type: "đgt", vietnamese: "Chiếu; trình diễn; bày tỏ", examples: ["Knỡng bruă hmei nao mdah rup tỉ buôn Alê A. - Cơ quan chúng tôi đi chiếu phim tại buôn Alê A.", "Hmei nao mdah klei kdō mmun. - Chúng tôi đi diễn văn nghệ."] }]
            },
            {
                ede: "Yăl dliê",
                meanings: [{ type: "đgt", vietnamese: "Nói chuyện, kể chuyện", examples: ["Aduôn kâo khăng yăl dliê klei đưm. - Bà tôi thường kể chuyện cổ tích.", "Hmei mnăn kpiê êjai, yăl dliê êjai. - Chúng tôi vừa uống rượu, vừa nói chuyện."] }]
            },
            {
                ede: "Năng ai",
                meanings: [{ type: "pht", vietnamese: "Khoảng chừng, có lẽ, có thể", examples: ["Ênoh mnuih nao kbin năng ai êbeh ko sa êtuh cô mnuih. - Số lượng người đi họp khoảng chừng hơn 100 người.", "Tơ dah jao bruă anei năng ai kão amâo dưi ngã ôh. - Nếu giao việc này có lẽ tôi không làm được đâu."] }]
            },
            {
                ede: "Thăn",
                meanings: [{ type: "dt", vietnamese: "Năm, tuổi", examples: ["Thun anei, adiê không. - Năm nay, trời hạn hán.", "Kâo mrâo pă pluh thũn. - Tôi mới 40 tuổi."] }]
            },
            {
                ede: "Dlông",
                meanings: [{ type: "tt", vietnamese: "Dài, cao", examples: ["Anak kâo dlông awan. - Con tôi cao ráo.", "Sang dlông Êđê mâo dua kdrễč. - Nhà dài Êđê có 2 phần."] }]
            },
            {
                ede: "Gŏ êsei",
                meanings: [{ type: "dt", vietnamese: "Nồi cơm, hộ, gia đình", examples: ["Gõ êsei kâo mâo tlâo čô mnuih. - Gia đình tôi có 3 người.", "Ami brei kơ ung mỗ kâo sa boh gõ êsei. - Mẹ cho vợ chồng tôi một cái nồi cơm.", "Grăp boh gõ êsei bi mâo hẽ hră gõ êsei. - Mỗi hộ gia đình phải có sổ hộ khẩu."] }]
            },
            {
                ede: "Čhĭ",
                meanings: [{ type: "đgt", vietnamese: "Bán, bỏ (mắm, muối vào thức ăn)", examples: ["Ami chi boh kroh. - Mẹ bán trái cây.", "Mỗ kâo chĩ hra hlăm djam. - Vợ tôi bỏ muối vào canh."] }]
            },
            {
                ede: "Doh",
                meanings: [{ type: "đgt", vietnamese: "Kéo, chảy", examples: ["Eman doh kyão. - Voi kéo gỗ.", "Êa doh êtăng. - Nước chảy xiết."] }]
            },
            {
                ede: "Hlăm",
                meanings: [{ type: "gt", vietnamese: "Trong, trên, dưới (nước)", examples: ["Anak kâo dum chum ao hlăm hip mdỡng. - Con tôi bỏ quần áo trong tủ.", "Čim ngă hruh hlăm ana kyão. - Chim làm tổ trên cây."] }]
            },
            {
                ede: "Hruh",
                meanings: [{ type: "dt", vietnamese: "Tổ (chim,..), gói (thuốc, bánh,...)", examples: ["Čim ngã hruh hlăm ana kyão. - Chim làm tổ trên cây. Hoặc: Kgâo hiu duah hruh hnuê. - Con gấu đi tìm tổ ong.", "Kão blei dua hruh hặt. - Tôi mua 2 gói thuốc. Hoặc: Kão blei dua hruh bên kơ anak kâo. - Tôi mua 2 gói bánh cho con tôi."] }]
            },
            {
                ede: "Lĕ",
                meanings: [{ type: "đgt", vietnamese: "Rơi, lặn (mặt trời)", examples: ["Kâo bi lĕ prăk. - Tôi làm rơi tiền.", "Yang hruê lẽ tĩng yũ: Mặt trời lặn phía Tây."] }]
            },
            {
                ede: "Hwiê",
                meanings: [{ type: "đgt", vietnamese: "Vứt bỏ, mây (song)", examples: ["Đăm hwiê djah pliă plia ôh. - Đừng vứt rác bừa bãi.", "Hwiê pioh mñam jhưng mdỗ. - Mây dùng để đan bàn ghế."] }]
            },
            {
                ede: "Êgao",
                meanings: [{ type: "pht", vietnamese: "Qua, quá", examples: ["Êgao êma mlan hriăm klei Êđê kão thâo čih, dlăng, hmữ leh anăn blũ. - Qua 5 tháng học tiếng Êđê tôi biết viết, đọc, nghe và nói.", "Kão nao hriăm klei Êđê êgao mmông leh. - Tôi đi học tiếng Êđê đã quá giờ rồi."] }]
            },
            {
                ede: "Wăt",
                meanings: [{ type: "dt", vietnamese: "Chim cút, cả, kể cả, cúng (sức khỏe)", examples: ["Anak kâo khăp bông čim wăt ăm. - Con tôi thích ăn thịt chim cút nướng.", "Kâo hnec mă bruă wăt miam. - Tôi tranh thủ làm việc cả ban đêm.", "Élão ko nao anôk kbưi, ama wặt kão hõng mnũ knô. - Trước khi đi công tác xa, bố cúng sức khỏe tôi với con gà trống."] }]
            },
            {
                ede: "Jhŏng",
                meanings: [{ type: "tt", vietnamese: "Dữ; dám", examples: ["Sang kâo rông sa drei asão jhong snak. - Nhà tôi nuôi một con chó rất dữ.", "Anak kâo amâo jhōng hiu chưn mmặt ôh. - Con tôi không dám đi chơi tối đâu."] }]
            },
            {
                ede: "Tŭk",
                meanings: [
                    { type: "đgt", vietnamese: "Nấu; luộc", examples: ["Mô̆ kâo tŭk êa. - Vợ tôi nấu nước.", "Anak tŭk ktor. - Con luộc bắp."] },
                    { type: "đgt", vietnamese: "Nấu (canh)", examples: [] }
                ]
            },
            {
                ede: "Mmông",
                meanings: [{ type: "dt", vietnamese: "Giờ đồng hồ", examples: ["Kão khăng nao mă bruă kjuh mmông aguah. - Tôi thường đi làm lúc 7 giờ sáng.", "Ung kâo blei mmông mrâo. - Chồng tôi mua đồng hồ mới."] }]
            },
            {
                ede: "Mdjiê",
                meanings: [{ type: "đgt", vietnamese: "Giết; tắt", examples: ["Arăng mdjiê êmô. - Người ta giết con bò.", "Êlão ko pīt, drei mdjiê hẽ pui. - Trước khi ngủ, chúng ta phải tắt điện."] }]
            },
            {
                ede: "Yuôm",
                meanings: [{ type: "tt", vietnamese: "Quý; đắt", examples: ["Kyâo jing mnỡng yuôm hlăm kmrỡng dliê. - Gỗ là loại quý trong rừng.", "Hlăm sang cơ chĩ djăp mnỡng yuôm s'ai. - Trong chợ bán mọi thứ đều đắt."] }]
            },
            {
                ede: "Jing",
                meanings: [{ type: "đt", vietnamese: "Là, thành, tốt, đạt, được", examples: ["Nu jing hđeh hriăm hrã: Nó là học sinh", "Mdiê sang kão jing ėdi: Lúa nhà tôi tốt lắm"] }]
            },
            {
                ede: "Mƀâo",
                meanings: [{ type: "đgt", vietnamese: "Ngửi; hôi", examples: ["Kão bão boh mkao: Tôi ngửi quả thị", "Yui bão snăk: Bọ xít rất hôi"] }]
            },
            {
                ede: "Čŏng",
                meanings: [{ type: "dt", vietnamese: "Đỉnh, chóp, tự", examples: ["Čăng cữ Phan Xi Păng dlông êdi: Đỉnh núi Phan Xi Păng cao lắm", "Nu čăng ngă sang: Nó tự làm nhà"] }]
            },
            {
                ede: "Pah",
                meanings: [{ type: "dt", vietnamese: "Màng; mảnh; thuê; mướn; vỗ; đập", examples: ["Tăm kpök sa pah klit: Bị tróc một mảng da", "Jih jang drei pah kngan: Tất cả chúng ta vỗ tay."] }]
            },
            {
                ede: "Mdih",
                meanings: [{ type: "dt", vietnamese: "Hôm kia; thức giấc", examples: ["Mdih ti ih nao?: Hôm kia anh đi đâu?", "Đăm blũ ktang ôh leh mdih: Đừng nói to kẻo bé thức giấc!"] }]
            },
            {
                ede: "Kđăl",
                meanings: [{ type: "dt", vietnamese: "Mề (gà); đóng; khóa, nghẽn...", examples: ["Anak kão khăp băng kđăl mnũ: Con tôi thích ăn mề gà", "Sang mnia kđăl băng hruē kjuh: Cửa hàng đóng cửa ngày chủ nhật."] }]
            },
            {
                ede: "Đăm",
                meanings: [{ type: "đgt", vietnamese: "Ngủ lại; đừng, chớ", examples: ["Ih đăm hõng hmei! - Chị ngủ lại với chúng tôi!", "Đăm ngå ya mta klei jhat! - Chớ làm những việc xấu!"] }]
            },
            {
                ede: "Mnga",
                meanings: [{ type: "dt", vietnamese: "Hoa; lãi, lời", examples: ["Tlao khūn msě si mnga. - Cười tươi như hoa", "Lỡ chỉ bông mnga. - Bán lại lấy lãi"] }]
            },
            {
                ede: "Ksŭng",
                meanings: [{ type: "đgt", vietnamese: "Xóc, súc, xông lên", examples: ["Kão ksũng giết čai. - Tôi xóc chai", "Leh huă, anak kâo ksũng băng égei: - Ăn xong, con tôi súc miệng."] }]
            },
            {
                ede: "Brăng",
                meanings: [{ type: "dt", vietnamese: "Bồ, vựa, bẻ", examples: ["Ama kão tuh mdie hläm brăng. - Bố tôi để thóc vào bồ", "Brăng mdie: Vựa lúa", "Êa doh mặt kơ brăng. - Nước chảy vào bể"] }]
            },
            {
                ede: "Krao",
                meanings: [{ type: "dt", vietnamese: "Sáo, họa mi, khướu; rên", examples: ["Čim krao mňě jăk edi: - Chim họa mi hót hay", "Blŭ msě si čim krao: - Nói như khướu.", "Mnuih ruă krao nanao: - Người ốm rên mãi."] }]
            },
            {
                ede: "Puh",
                meanings: [{ type: "đgt", vietnamese: "Lùa, thổi, cuốn, giạt", examples: ["Ung kão dôk puh êmô kbao wit kơ war: - Chồng tôi đang lùa trâu bò vào chuồng.", "Angin puh knam nao kơ yũ: - Gió thổi mây đen về phía tây.", "Đung puh phă hang : - trôi giạt vào bờ."] }]
            },
            {
                ede: "Phung",
                meanings: [{ type: "dt", vietnamese: "Đàn, đoàn, bầy, chúng, bọn, lũ, tôi...", examples: ["Hlăm kmrỡng mão phung hlỏ jhōng. - Trong rừng có bầy thú dữ.", "Phung hđeh dôk hlặp. - Lũ trẻ đang chơi"] }]
            },
            {
                ede: "Đê̆č",
                meanings: [{ type: "dt", vietnamese: "Hoa văn, khắc, trổ", examples: ["Boh đěč abăn bã anei siam edi! - Hoa văn cái địu này đẹp thật!", "Arăng dôk đěč boh hrã. - Người ta đang khắc chữ."] }]
            },
            {
                ede: "Krông",
                meanings: [{ type: "dt", vietnamese: "Càng, sông", examples: ["Krông ariêng anei prõng êdi! - Càng cua này to lắm", "Krông hrõ, klõ boh tão lhuih. - Sông cạn, đá mòn.", "Krông mão kčün, mnuih mão yun. - Sông có khúc, người có mệnh."] }]
            },
            {
                ede: "Kteh",
                meanings: [{ type: "đgt", vietnamese: "Quảng, ren, lắc, vẫy", examples: ["Yang hruê kteh hjan, mlan kteh không. - Mặt trời quảng thì mưa, mặt trăng quảng thì hạn.", "Elan kteh ti dlông mnal. - Đường ren trên vải", "Asão kteh ku drông pô. - Chó vẫy đuôi mừng chủ."] }]
            },
            {
                ede: "Kđheh",
                meanings: [{ type: "đgt", vietnamese: "Búng, gảy", examples: ["Kdheh hong kđiêng kngan: - Búng ngón tay", "Mã giê kďheh hdăm: - Lấy que gảy con kiến."] }]
            },
            {
                ede: "Kđip",
                meanings: [{ type: "đgt", vietnamese: "Cắp, cặp lại, kẹp, gắp...", examples: ["Ariêng kđip kngan: - cua cắp tay", "Kđip hră chỉ mnỡng mbit hõng hrã djā knal mdē. - Hóa đơn kẹp với chứng từ khác.", "Mã giê dưh kđip djam. - Lấy đũa gắp rau"] }]
            },
            {
                ede: "Kđŏng",
                meanings: [{ type: "tt", vietnamese: "Dỏng, vênh, hếch, kênh lên..", examples: ["Asão kđõng ku groh. - Con chó dỏng đuôi lên sủa", "Sa nah kyão kđông đi kơ dlông: - một đầu cây gỗ bị kênh lên"] }]
            },
            {
                ede: "Kgông",
                meanings: [{ type: "đgt", vietnamese: "Gặm, ngậm, tha", examples: ["Asão kgông klang. - Con chó gặm xương", "Čim kgông rỡk wit ngă hruh. - Chim tha cỏ về làm tổ"] }]
            },
            {
                ede: "Kẽ",
                meanings: [{ type: "đgt", vietnamese: "Cắn, đốt", examples: ["Asão kě jỡng ñu. - Chó cắn chân nó", "Anak kâo kě klõ bễn. - Con tôi cắn miếng bánh", "Kěč kě ba kman ruă. - Muỗi đốt truyền bệnh"] }]
            },
            {
                ede: "Ksăn",
                meanings: [{ type: "đgt", vietnamese: "Chồng, dồn", examples: ["Ksăn dăm boh chiên mbit. - Chồng mấy cái bát lên nhau", "Ksŭn bruă ko mnuih mkăn. - dồn việc cho người khác"] }]
            },
            {
                ede: "Ktang",
                meanings: [{ type: "tt", vietnamese: "Khỏe, mạnh, to, đặc", examples: ["Kbao anei ktang snak. - Con trâu này rất khỏe", "Ênai mtuh ktang. - Tiếng nổ mạnh", "Blu ktang. - Nói to", "Če kar ktang. - Chè pha đặc"] }]
            },
            {
                ede: "Hua",
                meanings: [{ type: "đgt", vietnamese: "Ăn (cơm)", examples: [] }]
            },
            {
                ede: "Kna",
                meanings: [{ type: "đgt", vietnamese: "Nấu (cơm)", examples: [] }]
            },
            {
                ede: "Ria",
                meanings: [{ type: "đgt", vietnamese: "Nấu (cháo, hầm,...)", examples: [] }]
            },
            {
                ede: "H'ô",
                meanings: [{ type: "đgt", vietnamese: "Mặc (áo)", examples: [] }]
            },
            {
                ede: "Mdai",
                meanings: [{ type: "đgt", vietnamese: "Đẻ, sinh (dùng cho con vật đẻ con)", examples: [] }]
            },
            {
                ede: "Čiêng",
                meanings: [{ type: "đgt", vietnamese: "Đeo (cặp (kdô), túi (bai)...)", examples: [] }]
            },
            {
                ede: "Truă",
                meanings: [{ type: "đgt", vietnamese: "Đeo (kính (ală king))", examples: [] }]
            },
            {
                ede: "Bäk",
                meanings: [{ type: "đgt", vietnamese: "Đeo (dây chuyền (klei mah))", examples: [] }]
            },
            {
                ede: "Atiêng",
                meanings: [{ type: "dt", vietnamese: "Nhánh (nhánh gừng, nhánh nghệ)", examples: [] }]
            },
            {
                ede: "Čo",
                meanings: [{ type: "tl", vietnamese: "Đứa, người (dùng cho con người)", examples: [] }]
            },
            {
                ede: "Hriê",
                meanings: [{ type: "đgt", vietnamese: "Tới, đến (đây)", examples: ["Ih hriê sang kão hõ!"] }]
            },
            {
                ede: "Truh",
                meanings: [{ type: "đgt", vietnamese: "(Đã) tới một địa điểm nào đó", examples: ["Kão truh kơ sang"] }]
            }
        ];

            // Function to display a modal message
            const showMessage = (msg) => {
                setMessage(msg);
            };

            // Function to close the modal message
            const closeMessage = () => {
                setMessage('');
            };

            // --- Firebase Initialization and Authentication ---
            useEffect(() => {
                console.log("Initializing Firebase..."); // Debugging log
                const initializeFirebase = async () => {
                    try {
                        // Retrieve Firebase config and app ID from global variables provided by the environment
                        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
                        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

                        if (!firebaseConfig) {
                            console.error("Firebase config is not available.");
                            setAuthLoading(false);
                            return;
                        }

                        // Initialize Firebase app, Auth, and Firestore instances
                        const app = window.firebase.initializeApp(firebaseConfig);
                        const authInstance = window.firebase.getAuth(app);
                        const firestoreInstance = window.firebase.getFirestore(app);

                        setDb(firestoreInstance); // Set Firestore instance to state
                        setAuth(authInstance); // Set Auth instance to state

                        // Listen for authentication state changes
                        window.firebase.onAuthStateChanged(authInstance, async (user) => {
                            if (user) {
                                // User is signed in
                                setUserId(user.uid);
                                setIsAuthenticated(true);
                                console.log("Firebase: User signed in with UID:", user.uid); // Debugging log
                            } else {
                                // User is signed out, attempt anonymous or custom token sign-in
                                console.log("Firebase: User signed out. Attempting sign-in..."); // Debugging log
                                try {
                                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                        // Sign in with custom token if available
                                        await window.firebase.signInWithCustomToken(authInstance, __initial_auth_token);
                                        console.log("Firebase: Signed in with custom token."); // Debugging log
                                    } else {
                                        // Fallback to anonymous sign-in
                                        await window.firebase.signInAnonymously(authInstance);
                                        console.log("Firebase: Signed in anonymously."); // Debugging log
                                    }
                                } catch (error) {
                                    console.error("Firebase sign-in error:", error);
                                    showMessage("Lỗi đăng nhập: " + error.message);
                                }
                            }
                            setAuthLoading(false); // Authentication process completed
                            console.log("Firebase: Auth loading finished."); // Debugging log
                        });
                    } catch (error) {
                        console.error("Error initializing Firebase:", error);
                        showMessage("Lỗi khởi tạo Firebase: " + error.message);
                        setAuthLoading(false);
                    }
                };
                initializeFirebase();
            }, []); // Empty dependency array means this effect runs once on mount

            // --- Dark Mode Toggle ---
            useEffect(() => {
                // Add or remove 'dark' class from the document element based on darkMode state
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [darkMode]); // Rerun when darkMode state changes

            const toggleDarkMode = () => {
                setDarkMode(!darkMode);
            };

            // SVG paths for sun and moon icons (for dark mode toggle)
            const sunIconPath = (
                <path fillRule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .75 0l.75.22a.75.75 0 0 1 .58.56l.006.048c.03.111.115.196.226.226l.048.006a.75.75 0 0 1 .56.58l.22.75a.75.75 0 0 1 0 .75l-.22.75a.75.75 0 0 1-.58.56l-.048.006a.75.75 0 0 1-.226.226l-.006.048a.75.75 0 0 1-.56.58l-.75.22a.75.75 0 0 1-.75 0l-.75-.22a.75.75 0 0 1-.58-.56l-.006-.048a.75.75 0 0 1-.226-.226l-.048-.006a.75.75 0 0 1-.56-.58l-.22-.75a.75.75 0 0 1 0-.75l.22-.75a.75.75 0 0 1 .58-.56l.048-.006a.75.75 0 0 1 .226-.226l.006-.048a.75.75 0 0 1 .56-.58l.75-.22ZM12 6a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 12 6ZM12 15a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 12 15ZM12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6ZM3.75 12a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75ZM18 12a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75ZM12 18.75a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5a.75.75 0 0 1 .75-.75ZM5.625 4.5a.75.75 0 0 1 .56-.56l.75-.22a.75.75 0 0 1 .75 0l.22.75a.75.75 0 0 1 0 .75l-.22.75a.75.75 0 0 1-.56.58l-.048.006a.75.75 0 0 1-.226.226l-.006.048a.75.75 0 0 1-.56.58l-.75.22a.75.75 0 0 1-.75 0l-.22-.75a.75.75 0 0 1 0-.75l.22-.75a.75.75 0 0 1 .56-.56l.048-.006a.75.75 0 0 1 .226-.226l.006-.048a.75.75 0 0 1 .56-.58l.75-.22ZM18.375 4.5a.75.75 0 0 1 .56-.56l.75-.22a.75.75 0 0 1 .75 0l.22.75a.75.75 0 0 1 0 .75l-.22.75a.75.75 0 0 1-.56.58l-.048.006a.75.75 0 0 1-.226.226l-.006.048a.75.75 0 0 1-.56.58l-.75.22a.75.75 0 0 1-.75 0l-.22-.75a.75.75 0 0 1 0-.75l.22-.75a.75.75 0 0 1 .56-.56l.048-.006a.75.75 0 0 1 .226-.226l.006-.048a.75.75 0 0 1 .56-.58l.75-.22ZM5.625 18.75a.75.75 0 0 1 .56-.56l.75-.22a.75.75 0 0 1 .75 0l.22.75a.75.75 0 0 1 0 .75l-.22.75a.75.75 0 0 1-.56.58l-.048.006a.75.75 0 0 1-.226.226l-.006.048a.75.75 0 0 1-.56.58l-.75.22a.75.75 0 0 1-.75 0l-.22-.75a.75.75 0 0 1 0-.75l.22-.75a.75.75 0 0 1 .56-.56l.048-.006a.75.75 0 0 1 .226-.226l.006-.048a.75.75 0 0 1 .56-.58l.75-.22ZM18.375 18.75a.75.75 0 0 1 .56-.56l.75-.22a.75.75 0 0 1 .75 0l.22.75a.75.75 0 0 1 0 .75l-.22.75a.75.75 0 0 1-.56.58l-.048.006a.75.75 0 0 0-.226.226l-.006.048a.75.75 0 0 1-.56.58l-.75.22a.75.75 0 0 1-.75 0l-.22-.75a.75.75 0 0 1 0-.75l.22-.75a.75.75 0 0 1 .56-.56l.048-.006a.75.75 0 0 1 .226-.226l.006-.048a.75.75 0 0 1 .56-.58l.75-.22Z" clipRule="evenodd" />
            );

            const moonIconPath = (
                <path d="M9.528 1.718a.75.75 0 0 1 .75 0l.75.22a.75.75 0 0 1 .58.56l.006.048c.03.111.115.196.226.226l.048.006a.75.75 0 0 1 .56.58l.22.75a.75.75 0 0 1 0 .75l-.22.75a.75.75 0 0 1-.58.56l-.048.006a.75.75 0 0 1-.226.226l-.006.048a.75.75 0 0 1-.56.58l-.75.22a.75.75 0 0 1-.75 0l-.75-.22a.75.75 0 0 1-.58-.56l-.006-.048a.75.75 0 0 1-.226-.226l-.048-.006a.75.75 0 0 1-.56-.58l-.22-.75a.75.75 0 0 1 0-.75l.22-.75a.75.75 0 0 1 .58-.56l.048-.006a.75.75 0 0 1 .226-.226l.006-.048a.75.75 0 0 1 .56-.58l.75-.22ZM12 6a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 12 6ZM12 15a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 12 15ZM12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6ZM3.75 12a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75ZM18 12a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75ZM12 18.75a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5a.75.75 0 0 1 .75-.75ZM5.625 4.5a.75.75 0 0 1 .56-.56l.75-.22a.75.75 0 0 1 .75 0l.22.75a.75.75 0 0 1 0 .75l-.22.75a.75.75 0 0 1-.56.58l-.048.006a.75.75 0 0 1-.226.226l-.006.048a.75.75 0 0 1-.56.58l-.75.22a.75.75 0 0 1-.75 0l-.22-.75a.75.75 0 0 1 0-.75l.22-.75a.75.75 0 0 1 .56-.56l.048-.006a.75.75 0 0 1 .226-.226l.006-.048a.75.75 0 0 1 .56-.58l.75-.22ZM18.375 4.5a.75.75 0 0 1 .56-.56l.75-.22a.75.75 0 0 1 .75 0l.22.75a.75.75 0 0 1 0 .75l-.22.75a.75.75 0 0 1-.56.58l-.048.006a.75.75 0 0 1-.226.226l-.006.048a.75.75 0 0 1-.56.58l-.75.22a.75.75 0 0 1-.75 0l-.22-.75a.75.75 0 0 1 0-.75l.22-.75a.75.75 0 0 1 .56-.56l.048-.006a.75.75 0 0 1 .226-.226l.006-.048a.75.75 0 0 1 .56-.58l.75-.22ZM5.625 18.75a.75.75 0 0 1 .56-.56l.75-.22a.75.75 0 0 1 .75 0l.22.75a.75.75 0 0 1 0 .75l-.22.75a.75.75 0 0 1-.56.58l-.048.006a.75.75 0 0 1-.226.226l-.006.048a.75.75 0 0 1-.56.58l-.75.22a.75.75 0 0 1-.75 0l-.22-.75a.75.75 0 0 1 0-.75l.22-.75a.75.75 0 0 1 .56-.56l.048-.006a.75.75 0 0 1 .226-.226l.006-.048a.75.75 0 0 1 .56-.58l.75-.22ZM18.375 18.75a.75.75 0 0 1 .56-.56l.75-.22a.75.75 0 0 1 .75 0l.22.75a.75.75 0 0 1 0 .75l-.22.75a.75.75 0 0 1-.56.58l-.048.006a.75.75 0 0 0-.226.226l-.006.048a.75.75 0 0 1-.56.58l-.75.22a.75.75 0 0 1-.75 0l-.22-.75a.75.75 0 0 1 0-.75l.22-.75a.75.75 0 0 1 .56-.56l.048-.006a.75.75 0 0 1 .226-.226l.006-.048a.75.75 0 0 1 .56-.58l.75-.22Z" />
            );

            // --- Reset states when changing tabs ---
            // This ensures a clean slate when switching between different functionalities.
            useEffect(() => {
                setImageSrc(null);
                setImageFile(null); // Clear image file
                setExtractedText('');
                setImageTranslation('');
                setIsLoadingImageTranslate(false);
                setSourceImageLang('ede'); // Reset source language
                setTargetImageLang('vietnamese'); // Reset target language

                setParagraphPrompt('');
                setParagraphWordCount(100); // Reset word count to default
                setGeneratedParagraph('');
                setIsLoadingParagraph(false);

                setExplanationWord('');
                setGeneratedExplanation('');
                setIsLoadingExplanation(false);

                setDictionaryWord('');
                setDictionaryResult('');
                setIsLoadingDictionary(false);
                setSourceDictionaryLang('ede');
                setTargetDictionaryLang('vietnamese');

                setSpeechSynthesisText('');
                setIsSpeaking(false);
                if (synthRef.current) {
                    synthRef.current.cancel(); // Stop any ongoing speech synthesis
                }
                setSelectedVoice(null); // Reset selected voice to null

                setMessage(''); // Clear any modal messages
                console.log(`Tab changed to: ${activeTab}. States reset.`); // Debugging log
            }, [activeTab]); // Effect runs whenever activeTab changes


            // --- Image Translation Logic ---
            const handleImageUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    setImageFile(file); // Store the file object to get its MIME type later
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setImageSrc(e.target.result); // Set image source for display
                        setExtractedText(''); // Clear previous extracted text
                        setImageTranslation(''); // Clear previous translation
                    };
                    reader.readAsDataURL(file); // Read file as Data URL (base64)
                }
            };

            const handleImageTranslate = async () => {
                if (!imageSrc || !imageFile) {
                    showMessage("Vui lòng chọn một hình ảnh trước.");
                    return;
                }
                if (sourceImageLang === targetImageLang) {
                    showMessage("Ngôn ngữ nguồn và ngôn ngữ đích không được giống nhau.");
                    return;
                }

                setIsLoadingImageTranslate(true);
                setExtractedText('');
                setImageTranslation('');

                try {
                    const base64ImageData = imageSrc.split(',')[1]; // Extract base64 data
                    const mimeType = imageFile.type; // Get MIME type from the file object

                    // Step 1: Extract text from image using AI
                    // The extraction prompt is general, as we don't know the language of the text in the image yet.
                    const extractPrompt = "Trích xuất tất cả văn bản từ hình ảnh này. Chỉ trả về văn bản thuần túy, không có giải thích hay định dạng gì thêm.";
                    let chatHistoryExtract = [];
                    chatHistoryExtract.push({ role: "user", parts: [{ text: extractPrompt }] });
                    chatHistoryExtract.push({ role: "user", parts: [{ inline_data: { mime_type: mimeType, data: base64ImageData } }] });

                    const payloadExtract = { contents: chatHistoryExtract };
                    const apiKey = ""; // API key is automatically provided by the Canvas environment
                    const apiUrlExtract = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    
                    const responseExtract = await fetch(apiUrlExtract, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payloadExtract)
                    });

                    // Handle API response for text extraction
                    if (!responseExtract.ok) {
                        const errorText = await responseExtract.text();
                        console.error(`API Error: Status ${responseExtract.status}, Status Text: ${responseExtract.statusText}, Body: ${errorText}`);
                        let errorMessage = `Lỗi API trích xuất văn bản: ${responseExtract.status} - ${responseExtract.statusText}`;
                        try {
                            const errorJson = JSON.parse(errorText);
                            if (errorJson.error && errorJson.error.message) {
                                errorMessage = `Lỗi API trích xuất văn bản: ${errorJson.error.message}`;
                            }
                        } catch (e) {
                            // Not a JSON error, use the raw text
                        }
                        throw new Error(errorMessage);
                    }

                    const resultExtract = await responseExtract.json();
                    let extractedTextFromImage = "Không thể trích xuất văn bản.";
                    if (resultExtract.candidates && resultExtract.candidates[0]?.content?.parts[0]?.text) {
                        extractedTextFromImage = resultExtract.candidates[0].content.parts[0].text;
                    }
                    setExtractedText(extractedTextFromImage);

                    // Step 2: Translate extracted text if successful and source/target languages are different
                    if (extractedTextFromImage && extractedTextFromImage.trim() !== "" && extractedTextFromImage !== "Không thể trích xuất văn bản.") {
                        let translatePrompt = "";
                        const sourceLangName = sourceImageLang === 'ede' ? 'Êđê' : 'Việt';
                        const targetLangName = targetImageLang === 'ede' ? 'Êđê' : 'Việt';

                        translatePrompt = `Dịch đoạn văn tiếng ${sourceLangName} sau sang tiếng ${targetLangName}: "${extractedTextFromImage}". Chỉ trả về bản dịch thuần túy, không có giải thích hay định dạng gì thêm.`;
                        
                        let chatHistoryTranslate = [];
                        chatHistoryTranslate.push({ role: "user", parts: [{ text: translatePrompt }] });
                        const payloadTranslate = { contents: chatHistoryTranslate };
                        const apiUrlTranslate = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                        const responseTranslate = await fetch(apiUrlTranslate, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payloadTranslate)
                        });

                        // Handle API response for translation
                        if (!responseTranslate.ok) {
                            const errorText = await responseTranslate.text();
                            console.error(`API Error: Status ${responseTranslate.status}, Status Text: ${responseTranslate.statusText}, Body: ${errorText}`);
                            let errorMessage = `Lỗi API dịch văn bản: ${responseTranslate.status} - ${responseTranslate.statusText}`;
                            try {
                                const errorJson = JSON.parse(errorText);
                                if (errorJson.error && errorJson.error.message) {
                                    errorMessage = `Lỗi API dịch văn bản: ${errorJson.error.message}`;
                                }
                            } catch (e) {
                                // Not a JSON error, use the raw text
                            }
                            throw new Error(errorMessage);
                        }

                        const resultTranslate = await responseTranslate.json();
                        let translatedText = "Không thể dịch văn bản.";
                        if (resultTranslate.candidates && resultTranslate.candidates[0]?.content?.parts[0]?.text) {
                            translatedText = resultTranslate.candidates[0].content.parts[0].text;
                        }
                        setImageTranslation(translatedText);
                    } else {
                        setImageTranslation("Không có văn bản để dịch.");
                    }

                } catch (error) {
                    console.error("Lỗi khi dịch ảnh:", error);
                    showMessage(`Đã xảy ra lỗi: ${error.message}. Vui lòng thử lại.`);
                    setExtractedText("Đã xảy ra lỗi khi trích xuất văn bản từ ảnh.");
                    setImageTranslation("Đã xảy ra lỗi khi dịch văn bản từ ảnh.");
                } finally {
                    setIsLoadingImageTranslate(false); // Hide loading indicator
                }
            };

            // Function to swap source and target languages for image translation
            const swapImageLanguages = () => {
                setSourceImageLang(targetImageLang);
                setTargetImageLang(sourceImageLang);
            };


            // --- Paragraph Generation Logic ---
            const generateParagraph = async () => {
                if (!paragraphPrompt.trim()) {
                    showMessage("Vui lòng nhập chủ đề để tạo đoạn văn.");
                    return;
                }
                setIsLoadingParagraph(true);
                setGeneratedParagraph('Đang tạo đoạn văn...'); // Set loading message
                try {
                    // Updated prompt to request introduction, body, and conclusion
                    const prompt = `Viết một đoạn văn bằng tiếng Êđê về chủ đề: "${paragraphPrompt}". Đoạn văn cần có cấu trúc rõ ràng gồm mở bài, thân bài và kết bài. Độ dài khoảng ${paragraphWordCount} từ. Đảm bảo ngữ pháp và từ vựng chính xác.`;
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // API key is automatically provided by the Canvas environment
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    // Handle API response
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`API Error: Status ${response.status}, Status Text: ${response.statusText}, Body: ${errorText}`);
                        let errorMessage = `Lỗi API tạo đoạn văn: ${response.status} - ${response.statusText}`;
                        try {
                            const errorJson = JSON.parse(errorText);
                            if (errorJson.error && errorJson.error.message) {
                                errorMessage = `Lỗi API tạo đoạn văn: ${errorJson.error.message}`;
                            }
                        } catch (e) {
                            // Not a JSON error, use the raw text
                        }
                        throw new Error(errorMessage);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        setGeneratedParagraph(result.candidates[0].content.parts[0].text);
                    } else {
                        console.error("API response missing expected content structure:", result);
                        setGeneratedParagraph("Không thể tạo đoạn văn: Phản hồi API không có nội dung mong muốn.");
                    }
                } catch (error) {
                    console.error("Lỗi khi tạo đoạn văn:", error);
                    showMessage(`Đã xảy ra lỗi khi tạo đoạn văn: ${error.message}. Vui lòng thử lại.`);
                    setGeneratedParagraph(`Đã xảy ra lỗi khi tạo đoạn văn: ${error.message}.`);
                } finally {
                    setIsLoadingParagraph(false); // Hide loading indicator
                }
            };

            // Function to save generated paragraph to Firebase history
            const saveParagraphToHistory = async () => {
                if (!isAuthenticated || !userId || !db) {
                    showMessage("Vui lòng đăng nhập để lưu lịch sử.");
                    return;
                }
                if (!paragraphPrompt.trim() || !generatedParagraph.trim()) {
                    showMessage("Không có đoạn văn để lưu.");
                    return;
                }
                try {
                    // Use __app_id for the collection path as required
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                    const historyCollectionRef = window.firebase.collection(db, `artifacts/${appId}/users/${userId}/ede_history`);
                    await window.firebase.addDoc(historyCollectionRef, {
                        type: 'paragraph_generation',
                        prompt: paragraphPrompt,
                        edeText: generatedParagraph,
                        wordCount: paragraphWordCount,
                        timestamp: window.firebase.serverTimestamp() // Use server timestamp for consistent ordering
                    });
                    showMessage("Đoạn văn đã được lưu vào lịch sử!");
                } catch (error) {
                    console.error("Lỗi khi lưu đoạn văn:", error);
                    showMessage("Lỗi khi lưu đoạn văn: " + error.message);
                }
            };

            // --- Explanation Logic ---
            const getExplanation = async () => {
                if (!explanationWord.trim()) {
                    showMessage("Vui lòng nhập từ hoặc khái niệm để giải thích.");
                    return;
                }
                setIsLoadingExplanation(true);
                setGeneratedExplanation('Đang giải thích...'); // Set loading message
                try {
                    const prompt = `Giải thích khái niệm/từ Êđê sau bằng tiếng Việt: "${explanationWord}". Trả lời ngắn gọn, rõ ràng, không quá 3 câu.`;
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiKey = ""; // API key is automatically provided by the Canvas environment
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    // Handle API response
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error(`API Error: Status ${response.status}, Status Text: ${response.statusText}, Body: ${errorText}`);
                        let errorMessage = `Lỗi API giải thích: ${response.status} - ${response.statusText}`;
                        try {
                            const errorJson = JSON.parse(errorText);
                            if (errorJson.error && errorJson.error.message) {
                                errorMessage = `Lỗi API giải thích: ${errorJson.error.message}`;
                            }
                        } catch (e) {
                            // Not a JSON error, use the raw text
                        }
                        throw new Error(errorMessage);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        setGeneratedExplanation(result.candidates[0].content.parts[0].text);
                    } else {
                        setGeneratedExplanation("Không thể giải thích khái niệm này.");
                    }
                } catch (error) {
                    console.error("Lỗi khi giải thích:", error);
                    showMessage("Đã xảy ra lỗi khi giải thích: " + error.message);
                    setGeneratedExplanation("Đã xảy ra lỗi khi giải thích.");
                } finally {
                    setIsLoadingExplanation(false); // Hide loading indicator
                }
            };

            // Function to save generated explanation to Firebase history
            const saveExplanationToHistory = async () => {
                if (!isAuthenticated || !userId || !db) {
                    showMessage("Vui lòng đăng nhập để lưu lịch sử.");
                    return;
                }
                if (!explanationWord.trim() || !generatedExplanation.trim()) {
                    showMessage("Không có giải thích để lưu.");
                    return;
                }
                try {
                    // Use __app_id for the collection path as required
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                    const historyCollectionRef = window.firebase.collection(db, `artifacts/${appId}/users/${userId}/ede_history`);
                    await window.firebase.addDoc(historyCollectionRef, {
                        type: 'explanation',
                        word: explanationWord,
                        explanationText: generatedExplanation,
                        timestamp: window.firebase.serverTimestamp() // Use server timestamp for consistent ordering
                    });
                    showMessage("Giải thích đã được lưu vào lịch sử!");
                } catch (error) {
                    console.error("Lỗi khi lưu giải thích:", error);
                    showMessage("Lỗi khi lưu giải thích: " + error.message);
                }
            };

            // --- Dictionary Lookup Logic ---
            const handleDictionaryLookup = async () => {
                if (!dictionaryWord.trim()) {
                    showMessage("Vui lòng nhập từ để tra cứu.");
                    return;
                }
                if (sourceDictionaryLang === targetDictionaryLang) {
                    showMessage("Ngôn ngữ nguồn và ngôn ngữ đích không được giống nhau.");
                    return;
                }

                setIsLoadingDictionary(true);
                setDictionaryResult('Đang tra cứu...');

                try {
                    let foundInLocalDictionary = false;
                    let resultText = '';

                    // First, try to find in the local hardcoded dictionary
                    if (sourceDictionaryLang === 'ede' && targetDictionaryLang === 'vietnamese') {
                        const found = edeDictionary.find(entry => entry.ede.toLowerCase() === dictionaryWord.toLowerCase());
                        if (found) {
                            resultText = found.vietnamese;
                            foundInLocalDictionary = true;
                        }
                    } else if (sourceDictionaryLang === 'vietnamese' && targetDictionaryLang === 'ede') {
                        const found = edeDictionary.find(entry => entry.vietnamese.toLowerCase() === dictionaryWord.toLowerCase());
                        if (found) {
                            resultText = found.ede;
                            foundInLocalDictionary = true;
                        }
                    }

                    if (foundInLocalDictionary) {
                        setDictionaryResult(`(Từ điển nội bộ) ${resultText}`);
                    } else {
                        // If not found in local dictionary, use AI (simulating web search)
                        let prompt = "";
                        const sourceLangName = sourceDictionaryLang === 'ede' ? 'Êđê' : 'Việt';
                        const targetLangName = targetDictionaryLang === 'ede' ? 'Êđê' : 'Việt';

                        prompt = `Dịch từ/cụm từ tiếng ${sourceLangName} sau sang tiếng ${targetLangName}: "${dictionaryWord}". Chỉ trả về bản dịch/giải thích thuần túy, không có giải thích hay định dạng gì thêm. Nếu là từ Êđê, cung cấp cả nghĩa và một ví dụ nếu có thể.`;
                        
                        let chatHistory = [];
                        chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                        const payload = { contents: chatHistory };
                        const apiKey = ""; // API key is automatically provided by the Canvas environment
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                        
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            const errorText = await response.text();
                            console.error(`API Error: Status ${response.status}, Status Text: ${response.statusText}, Body: ${errorText}`);
                            let errorMessage = `Lỗi API tra cứu: ${response.status} - ${response.statusText}`;
                            try {
                                const errorJson = JSON.parse(errorText);
                                if (errorJson.error && errorJson.error.message) {
                                    errorMessage = `Lỗi API tra cứu: ${errorJson.error.message}`;
                                }
                            } catch (e) {
                                // Not a JSON error, use the raw text
                            }
                            throw new Error(errorMessage);
                        }

                        const result = await response.json();
                        if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            setDictionaryResult(`(Tra cứu AI) ${result.candidates[0].content.parts[0].text}`);
                        } else {
                            setDictionaryResult("Không tìm thấy kết quả nào.");
                        }
                    }
                } catch (error) {
                    console.error("Lỗi khi tra cứu từ điển:", error);
                    showMessage(`Đã xảy ra lỗi khi tra cứu: ${error.message}. Vui lòng thử lại.`);
                    setDictionaryResult(`Đã xảy ra lỗi khi tra cứu: ${error.message}.`);
                } finally {
                    setIsLoadingDictionary(false);
                }
            };

            const swapDictionaryLanguages = () => {
                setSourceDictionaryLang(targetDictionaryLang);
                setTargetDictionaryLang(sourceDictionaryLang);
                setDictionaryResult(''); // Clear result on swap
            };

            const saveDictionaryLookupToHistory = async () => {
                if (!isAuthenticated || !userId || !db) {
                    showMessage("Vui lòng đăng nhập để lưu lịch sử.");
                    return;
                }
                if (!dictionaryWord.trim() || !dictionaryResult.trim()) {
                    showMessage("Không có kết quả tra cứu để lưu.");
                    return;
                }
                try {
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                    const historyCollectionRef = window.firebase.collection(db, `artifacts/${appId}/users/${userId}/ede_history`);
                    await window.firebase.addDoc(historyCollectionRef, {
                        type: 'dictionary_lookup',
                        word: dictionaryWord,
                        sourceLang: sourceDictionaryLang,
                        targetLang: targetDictionaryLang,
                        result: dictionaryResult,
                        timestamp: window.firebase.serverTimestamp()
                    });
                    showMessage("Kết quả tra cứu đã được lưu vào lịch sử!");
                } catch (error) {
                    console.error("Lỗi khi lưu tra cứu từ điển:", error);
                    showMessage("Lỗi khi lưu tra cứu từ điển: " + error.message);
                }
            };

            // --- Speech-to-Text Logic (Removed from UI) ---
            // Keeping the useEffect and functions for potential future re-introduction or debugging
            useEffect(() => {
                // Check if browser supports SpeechRecognition API
                if (!('webkitSpeechRecognition' in window)) {
                    // showMessage("Trình duyệt của bạn không hỗ trợ nhận dạng giọng nói. Vui lòng sử dụng Chrome hoặc trình duyệt tương thích.");
                    return;
                }

                const SpeechRecognition = window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                recognition.continuous = false; // Set to true for continuous recognition
                recognition.interimResults = true; // Get interim results for live feedback
                recognition.lang = 'vi-VN'; // Set language to Vietnamese

                // Event handlers for speech recognition
                recognition.onstart = () => {
                    setIsRecording(true);
                    setSpeechRecognitionText('Đang nghe...');
                };

                recognition.onresult = (event) => {
                    let interimTranscript = '';
                    let finalTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; ++i) {
                        const transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }
                    setSpeechRecognitionText(finalTranscript || interimTranscript); // Display final or interim text
                };

                recognition.onerror = (event) => {
                    setIsRecording(false);
                    console.error("Speech recognition error:", event.error);
                    setSpeechRecognitionText(`Lỗi: ${event.error}. Vui lòng thử lại.`);
                    // showMessage(`Lỗi nhận dạng giọng nói: ${event.error}. Vui lòng kiểm tra micro và cấp quyền.`);
                };

                recognition.onend = () => {
                    setIsRecording(false);
                    if (speechRecognitionText === 'Đang nghe...') {
                        setSpeechRecognitionText('Không nhận dạng được giọng nói. Vui lòng thử lại.');
                    }
                };

                recognitionRef.current = recognition; // Store recognition object in ref

                // Cleanup function to stop recognition if component unmounts
                return () => {
                    if (recognitionRef.current) {
                        recognitionRef.current.stop();
                    }
                };
            }, []); // Empty dependency array means this effect runs once on mount

            const startSpeechRecognition = () => {
                if (recognitionRef.current) {
                    setSpeechRecognitionText(''); // Clear previous text
                    recognitionRef.current.start(); // Start recognition
                }
            };

            const stopSpeechRecognition = () => {
                if (recognitionRef.current) {
                    recognitionRef.current.stop(); // Stop recognition
                }
            };

            // --- Text-to-Speech Logic ---
            useEffect(() => {
                console.log("TTS useEffect triggered."); // Debugging log
                // Check if browser supports SpeechSynthesis API
                if (!('speechSynthesis' in window)) {
                    showMessage("Trình duyệt của bạn không hỗ trợ chuyển văn bản thành giọng nói.");
                    return;
                }

                const synth = window.speechSynthesis;
                synthRef.current = synth; // Store synth object in ref

                const loadVoices = () => {
                    console.log("Loading voices..."); // Debugging log
                    const availableVoices = synth.getVoices();
                    setVoices(availableVoices); // Set available voices
                    // Try to select a Vietnamese voice by default
                    const defaultVietnameseVoice = availableVoices.find(voice => voice.lang === 'vi-VN');
                    if (defaultVietnameseVoice) {
                        setSelectedVoice(defaultVietnameseVoice);
                        console.log("Default Vietnamese voice selected:", defaultVietnameseVoice.name); // Debugging log
                    } else if (availableVoices.length > 0) {
                        // Fallback to first available voice if no Vietnamese voice is found
                        setSelectedVoice(availableVoices[0]);
                        console.log("Fallback to first available voice:", availableVoices[0].name); // Debugging log
                    }
                };

                // Load voices when they change (e.g., after page load or new voices are installed)
                synth.onvoiceschanged = loadVoices;
                // Load voices immediately if they are already available (for cases where onvoiceschanged might not fire)
                if (synth.getVoices().length > 0) {
                    loadVoices();
                }

                // Cleanup function to cancel any ongoing speech if component unmounts
                return () => {
                    if (synthRef.current) {
                        synthRef.current.cancel();
                    }
                };
            }, []); // Empty dependency array means this effect runs once on mount

            const speakText = () => {
                if (!speechSynthesisText.trim()) {
                    showMessage("Vui lòng nhập văn bản để đọc.");
                    return;
                }
                if (!synthRef.current) {
                    showMessage("Chức năng chuyển văn bản thành giọng nói không khả dụng.");
                    return;
                }
                
                if (synthRef.current.speaking) {
                    synthRef.current.cancel(); // Stop current speech if any is ongoing
                }

                const utterance = new SpeechSynthesisUtterance(speechSynthesisText);
                if (selectedVoice) {
                    utterance.voice = selectedVoice; // Use selected voice
                    console.log("Speaking with selected voice:", selectedVoice.name); // Debugging log
                } else {
                    utterance.lang = 'vi-VN'; // Fallback to Vietnamese language if no specific voice is selected
                    console.log("Speaking with default Vietnamese language."); // Debugging log
                }

                // Event handlers for speech synthesis
                utterance.onstart = () => setIsSpeaking(true);
                utterance.onend = () => setIsSpeaking(false);
                utterance.onerror = (event) => {
                    setIsSpeaking(false);
                    console.error("Speech synthesis error:", event.error);
                    showMessage(`Lỗi chuyển văn bản thành giọng nói: ${event.error}`);
                };

                synthRef.current.speak(utterance); // Start speaking
            };

            const stopSpeaking = () => {
                if (synthRef.current && synthRef.current.speaking) {
                    synthRef.current.cancel(); // Cancel current speech
                    setIsSpeaking(false);
                }
            };

            // --- History Logic ---
            useEffect(() => {
                // Fetch history only if authenticated, Firebase is initialized, and on the 'history' tab
                if (db && userId && isAuthenticated && activeTab === 'history') {
                    console.log("Fetching history for user:", userId); // Debugging log
                    if (historyUnsubscribeRef.current) {
                        historyUnsubscribeRef.current(); // Unsubscribe from previous listener to avoid duplicates
                    }
                    // Define the Firestore collection path using __app_id
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                    const historyCollectionRef = window.firebase.collection(db, `artifacts/${appId}/users/${userId}/ede_history`);
                    // Create a query without orderBy to avoid index issues, sorting will be done in memory
                    const q = window.firebase.query(historyCollectionRef);
                    
                    // Set up a real-time listener for the history collection
                    historyUnsubscribeRef.current = window.firebase.onSnapshot(q, (snapshot) => {
                        const items = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        // Sort items by timestamp in descending order (newest first) in memory
                        const sortedItems = items.sort((a, b) => {
                            const dateA = a.timestamp?.toDate ? a.timestamp.toDate() : new Date(a.timestamp);
                            const dateB = b.timestamp?.toDate ? b.timestamp.toDate() : new Date(b.timestamp);
                            return dateB - dateA;
                        });
                        setHistoryItems(sortedItems);
                        console.log("History fetched:", sortedItems.length, "items."); // Debugging log
                    }, (error) => {
                        console.error("Error fetching history:", error);
                        showMessage("Lỗi khi tải lịch sử: " + error.message);
                    });
                } else if (historyUnsubscribeRef.current) {
                    // Unsubscribe and clear history if not authenticated or not on history tab
                    console.log("Unsubscribing from history listener."); // Debugging log
                    historyUnsubscribeRef.current();
                    historyUnsubscribeRef.current = null;
                    setHistoryItems([]);
                }
                // Cleanup function for the effect
                return () => {
                    if (historyUnsubscribeRef.current) {
                        historyUnsubscribeRef.current();
                    }
                };
            }, [db, userId, isAuthenticated, activeTab]); // Dependencies for this effect

            // Helper function to format Firebase Timestamps
            const formatTimestamp = (timestamp) => {
                if (!timestamp) return 'N/A';
                // Convert Firebase Timestamp object to Date object if needed, then format
                const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
                return date.toLocaleString('vi-VN'); // Format date to Vietnamese locale string
            };

            // Show loading spinner while Firebase is initializing
            if (authLoading) {
                console.log("Auth is loading, showing spinner."); // Debugging log
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-800">
                        <div className="loader"></div>
                        <p className="ml-4 text-gray-700 dark:text-gray-300">Đang tải ứng dụng...</p>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-100 to-purple-100 dark:from-gray-900 dark:to-gray-700 flex flex-col items-center p-4 transition-colors duration-300">
                    <div className="w-full max-w-3xl mx-auto space-y-8">
                        
                        {/* Header and Dark Mode Toggle */}
                        <div className="flex justify-between items-center mb-6">
                            <div className="text-center flex-grow flex items-center justify-center">
                                {/* Removed Vietnamese Flag Image with waving animation */}
                                <h1 className="text-4xl md:text-5xl font-extrabold text-gray-800 dark:text-white mb-2">
                                    <span className="text-indigo-600 dark:text-indigo-400">Từ điển</span> & <span className="text-purple-600 dark:text-purple-400">Dịch thuật Êđê</span>
                                </h1>
                            </div>
                            <button
                                onClick={toggleDarkMode}
                                className="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 shadow-md hover:shadow-lg transition-all"
                                aria-label="Toggle dark mode"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-6 h-6">
                                    {darkMode ? sunIconPath : moonIconPath}
                                </svg>
                            </button>
                        </div>

                        {/* Navigation Tabs */}
                        <div className="flex justify-center border-b border-gray-200 dark:border-gray-700 mb-8 overflow-x-auto">
                            <TabButton tabName="alphabet" activeTab={activeTab} setActiveTab={setActiveTab}>Bảng chữ cái Êđê</TabButton>
                            <TabButton tabName="dictionary" activeTab={activeTab} setActiveTab={setActiveTab}>Tra Từ Điển</TabButton> {/* New Tab */}
                            <TabButton tabName="image" activeTab={activeTab} setActiveTab={setActiveTab}>Dịch Từ Ảnh</TabButton>
                            <TabButton tabName="generate" activeTab={activeTab} setActiveTab={setActiveTab}>Tạo Đoạn Văn</TabButton>
                            <TabButton tabName="explain" activeTab={activeTab} setActiveTab={setActiveTab}>Giải Thích</TabButton>
                            <TabButton tabName="textToSpeech" activeTab={activeTab} setActiveTab={setActiveTab}>Văn bản thành Giọng nói</TabButton>
                            <TabButton tabName="history" activeTab={activeTab} setActiveTab={setActiveTab}>Lịch Sử</TabButton> {/* History Tab */}
                        </div>

                        {/* Tab Content - Conditional Rendering based on activeTab */}
                        {activeTab === 'alphabet' && (
                            <div className="bg-white dark:bg-gray-700 p-6 md:p-8 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 transition-all duration-300 hover:shadow-xl">
                                <h2 className="text-2xl font-bold text-gray-800 dark:text-white mb-4">Bảng chữ cái và Ký tự Đặc biệt của tiếng Êđê</h2>
                                <p className="text-gray-600 dark:text-gray-400 mb-6">Dưới đây là bảng các chữ cái và ký tự đặc biệt trong tiếng Êđê, cùng với âm tiếng Việt tương ứng và ghi chú.</p>
                                <div className="overflow-x-auto">
                                    <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-600 rounded-lg overflow-hidden">
                                        <thead className="bg-gradient-to-r from-indigo-500 to-purple-500 text-white">
                                            <tr>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider rounded-tl-lg">Chữ Êđê (In hoa/thường)</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Âm tiếng Việt tương ứng</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">Unicode (Ví dụ)</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider rounded-tr-lg">Ghi chú/Vấn đề hiển thị</th>
                                            </tr>
                                        </thead>
                                        <tbody className="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600">
                                            {edeAlphabet.map((item, index) => (
                                                <tr key={index} className={index % 2 === 0 ? 'bg-gray-50 dark:bg-gray-700' : 'bg-white dark:bg-gray-800'}>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">{item.char}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{item.vietnameseSound}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300 font-mono">{item.unicode}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{item.notes}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'dictionary' && (
                            <div className="bg-white dark:bg-gray-700 p-6 md:p-8 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 transition-all duration-300 hover:shadow-xl">
                                <h2 className="text-2xl font-bold text-gray-800 dark:text-white mb-4">Tra Từ Điển</h2>
                                <p className="text-gray-600 dark:text-gray-400 mb-4">Tra cứu từ trong từ điển nội bộ hoặc sử dụng AI để tìm kiếm trên mạng.</p>
                                <div className="space-y-4">
                                    {/* Language Selection for Dictionary */}
                                    <div className="flex items-center justify-center space-x-4 mb-4">
                                        <div className="flex flex-col items-center">
                                            <label htmlFor="sourceDictionaryLang" className="block text-gray-700 dark:text-gray-300 text-sm font-semibold mb-2">
                                                Ngôn ngữ nguồn:
                                            </label>
                                            <select
                                                id="sourceDictionaryLang"
                                                className="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-white"
                                                value={sourceDictionaryLang}
                                                onChange={(e) => setSourceDictionaryLang(e.target.value)}
                                            >
                                                <option value="ede">Tiếng Êđê</option>
                                                <option value="vietnamese">Tiếng Việt</option>
                                            </select>
                                        </div>
                                        <button
                                            onClick={swapDictionaryLanguages}
                                            className="p-2 rounded-full bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 shadow-md hover:shadow-lg transition-all mt-6"
                                            aria-label="Swap languages"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-5 h-5">
                                                <path fillRule="evenodd" d="M16.28 11.47a.75.75 0 0 0 0-1.06L14.21 8.47a.75.75 0 0 0-1.06 0 .75.75 0 0 0 0 1.06l1.22 1.22H4.5a.75.75 0 0 0 0 1.5h9.89l-1.22 1.22a.75.75 0 1 0 1.06 1.06l2.07-2.07ZM7.72 12.97a.75.75 0 0 0 0 1.06l2.07 2.07a.75.75 0 0 0 1.06 0 .75.75 0 0 0 0-1.06l-1.22-1.22H19.5a.75.75 0 0 0 0-1.5h-9.89l1.22-1.22a.75.75 0 0 0-1.06-1.06l-2.07 2.07Z" clipRule="evenodd" />
                                            </svg>
                                        </button>

                                        <div className="flex flex-col items-center">
                                            <label htmlFor="targetDictionaryLang" className="block text-gray-700 dark:text-gray-300 text-sm font-semibold mb-2">
                                                Ngôn ngữ đích:
                                            </label>
                                            <select
                                                id="targetDictionaryLang"
                                                className="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-white"
                                                value={targetDictionaryLang}
                                                onChange={(e) => setTargetDictionaryLang(e.target.value)}
                                            >
                                                <option value="vietnamese">Tiếng Việt</option>
                                                <option value="ede">Tiếng Êđê</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div>
                                        <label htmlFor="dictionaryWord" className="block text-gray-700 dark:text-gray-300 text-sm font-semibold mb-2">
                                            Từ cần tra cứu:
                                        </label>
                                        <input
                                            type="text"
                                            id="dictionaryWord"
                                            className="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200 ease-in-out text-gray-800 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 text-lg bg-gray-50 dark:bg-gray-800"
                                            placeholder={sourceDictionaryLang === 'ede' ? "Ví dụ: Klei, Buôn" : "Ví dụ: Làng, Học"}
                                            value={dictionaryWord}
                                            onChange={(e) => setDictionaryWord(e.target.value)}
                                        />
                                    </div>
                                    <button
                                        onClick={handleDictionaryLookup}
                                        disabled={isLoadingDictionary || !dictionaryWord.trim() || sourceDictionaryLang === targetDictionaryLang}
                                        className="w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors"
                                    >
                                        {isLoadingDictionary ? <div className="loader"></div> : 'Tra Từ'}
                                    </button>
                                    {dictionaryResult && (
                                        <div className="mt-4 bg-indigo-50 dark:bg-indigo-900 p-4 rounded-lg border border-indigo-200 dark:border-indigo-700">
                                            <h3 className="text-md font-semibold text-indigo-800 dark:text-indigo-200 mb-1">Kết quả:</h3>
                                            <p className="text-gray-800 dark:text-gray-100 text-base whitespace-pre-wrap">{dictionaryResult}</p>
                                            {isAuthenticated && (
                                                <button
                                                    onClick={saveDictionaryLookupToHistory}
                                                    className="mt-3 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
                                                >
                                                    Lưu vào Lịch Sử
                                                </button>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'image' && (
                            <div className="bg-white dark:bg-gray-700 p-6 md:p-8 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 transition-all duration-300 hover:shadow-xl">
                                <h2 className="text-2xl font-bold text-gray-800 dark:text-white mb-4">Dịch từ ảnh</h2>
                                <p className="text-gray-600 dark:text-gray-400 mb-4">Tải lên một hình ảnh chứa văn bản để trích xuất và dịch giữa tiếng Êđê và tiếng Việt.</p>
                                <div className="space-y-4">
                                    {/* Language Selection */}
                                    <div className="flex items-center justify-center space-x-4 mb-4">
                                        <div className="flex flex-col items-center">
                                            <label htmlFor="sourceImageLang" className="block text-gray-700 dark:text-gray-300 text-sm font-semibold mb-2">
                                                Ngôn ngữ nguồn:
                                            </label>
                                            <select
                                                id="sourceImageLang"
                                                className="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-white"
                                                value={sourceImageLang}
                                                onChange={(e) => setSourceImageLang(e.target.value)}
                                            >
                                                <option value="ede">Tiếng Êđê</option>
                                                <option value="vietnamese">Tiếng Việt</option>
                                            </select>
                                        </div>
                                        <button
                                            onClick={swapImageLanguages}
                                            className="p-2 rounded-full bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 shadow-md hover:shadow-lg transition-all mt-6"
                                            aria-label="Swap languages"
                                        >
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-5 h-5">
                                                <path fillRule="evenodd" d="M16.28 11.47a.75.75 0 0 0 0-1.06L14.21 8.47a.75.75 0 0 0-1.06 0 .75.75 0 0 0 0 1.06l1.22 1.22H4.5a.75.75 0 0 0 0 1.5h9.89l-1.22 1.22a.75.75 0 1 0 1.06 1.06l2.07-2.07ZM7.72 12.97a.75.75 0 0 0 0 1.06l2.07 2.07a.75.75 0 0 0 1.06 0 .75.75 0 0 0 0-1.06l-1.22-1.22H19.5a.75.75 0 0 0 0-1.5h-9.89l1.22-1.22a.75.75 0 0 0-1.06-1.06l-2.07 2.07Z" clipRule="evenodd" />
                                            </svg>
                                        </button>

                                        <div className="flex flex-col items-center">
                                            <label htmlFor="targetImageLang" className="block text-gray-700 dark:text-gray-300 text-sm font-semibold mb-2">
                                                Ngôn ngữ đích:
                                            </label>
                                            <select
                                                id="targetImageLang"
                                                className="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-800 text-gray-800 dark:text-white"
                                                value={targetImageLang}
                                                onChange={(e) => setTargetImageLang(e.target.value)}
                                            >
                                                <option value="vietnamese">Tiếng Việt</option>
                                                <option value="ede">Tiếng Êđê</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div className="p-4 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg text-center bg-gray-50 dark:bg-gray-800">
                                        <label htmlFor="imageUpload" className="cursor-pointer inline-flex items-center justify-center px-5 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 transition-colors">
                                            Chọn ảnh
                                        </label>
                                        <input id="imageUpload" type="file" accept="image/jpeg,image/png,image/gif" className="hidden" onChange={handleImageUpload} />
                                        <p className="text-xs text-gray-500 dark:text-gray-400 mt-2">PNG, JPG, GIF,...</p>
                                    </div>

                                    {imageSrc && (
                                        <div className="mt-4 text-center">
                                            <img src={imageSrc} alt="Ảnh đã tải lên" className="max-w-full max-h-60 mx-auto rounded-lg shadow-md" />
                                        </div>
                                    )}
                                    
                                    <button
                                        onClick={handleImageTranslate}
                                        disabled={isLoadingImageTranslate || !imageSrc || sourceImageLang === targetImageLang}
                                        className="w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors"
                                    >
                                        {isLoadingImageTranslate ? <div className="loader"></div> : 'Trích xuất & Dịch từ ảnh'}
                                    </button>

                                    {(extractedText || imageTranslation || isLoadingImageTranslate) && (
                                        <div className="mt-4 space-y-4">
                                            <div className="bg-purple-50 dark:bg-purple-900 p-4 rounded-lg border border-purple-200 dark:border-purple-700">
                                                <h3 className="text-md font-semibold text-purple-800 dark:text-purple-200 mb-1">Văn bản gốc ({sourceImageLang === 'ede' ? 'Êđê' : 'Việt'}):</h3>
                                                <p className="text-gray-800 dark:text-gray-100 text-base whitespace-pre-wrap">
                                                    {isLoadingImageTranslate && !extractedText ? "Đang trích xuất văn bản..." : extractedText}
                                                </p>
                                            </div>
                                            <div className="bg-indigo-50 dark:bg-indigo-900 p-4 rounded-lg border border-indigo-200 dark:border-indigo-700">
                                                <h3 className="text-md font-semibold text-indigo-800 dark:text-indigo-200 mb-1">Bản dịch ({targetImageLang === 'ede' ? 'Êđê' : 'Việt'}):</h3>
                                                <p className="text-gray-800 dark:text-gray-100 text-base whitespace-pre-wrap">
                                                    {isLoadingImageTranslate && !imageTranslation ? "Đang dịch văn bản..." : imageTranslation}
                                                </p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'generate' && (
                            <div className="bg-white dark:bg-gray-700 p-6 md:p-8 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 transition-all duration-300 hover:shadow-xl">
                                <h2 className="text-2xl font-bold text-gray-800 dark:text-white mb-4">Tạo đoạn văn Êđê</h2>
                                <p className="text-gray-600 dark:text-gray-400 mb-4">Nhập một chủ đề bằng tiếng Việt, AI sẽ giúp bạn tạo một đoạn văn ngắn bằng tiếng Êđê có mở bài, thân bài và kết bài.</p>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="paragraphPrompt" className="block text-gray-700 dark:text-gray-300 text-sm font-semibold mb-2">
                                            Chủ đề (tiếng Việt):
                                        </label>
                                        <textarea
                                            id="paragraphPrompt"
                                            className="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200 ease-in-out text-gray-800 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 text-lg bg-gray-50 dark:bg-gray-800 min-h-[100px]"
                                            placeholder="Ví dụ: Một ngày ở buôn làng, Lễ hội truyền thống Êđê..."
                                            value={paragraphPrompt}
                                            onChange={(e) => setParagraphPrompt(e.target.value)}
                                        ></textarea>
                                    </div>
                                    <div>
                                        <label htmlFor="paragraphWordCount" className="block text-gray-700 dark:text-gray-300 text-sm font-semibold mb-2">
                                            Số lượng từ mong muốn:
                                        </label>
                                        <input
                                            type="number"
                                            id="paragraphWordCount"
                                            min="10"
                                            max="500"
                                            step="10"
                                            className="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200 ease-in-out text-gray-800 dark:text-white text-lg bg-gray-50 dark:bg-gray-800"
                                            value={paragraphWordCount}
                                            onChange={(e) => setParagraphWordCount(Math.max(10, Math.min(500, parseInt(e.target.value) || 0)))}
                                        />
                                        <p className="text-xs text-gray-500 dark:text-gray-400 mt-1">Khoảng 10 - 500 từ.</p>
                                    </div>
                                    <button
                                        onClick={generateParagraph}
                                        disabled={isLoadingParagraph}
                                        className="w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors"
                                    >
                                        {isLoadingParagraph ? <div className="loader"></div> : 'Tạo Đoạn Văn'}
                                    </button>
                                    {generatedParagraph && (
                                        <div className="mt-4 bg-indigo-50 dark:bg-indigo-900 p-4 rounded-lg border border-indigo-200 dark:border-indigo-700">
                                            <h3 className="text-md font-semibold text-indigo-800 dark:text-indigo-200 mb-1">Đoạn văn Êđê:</h3>
                                            <p className="text-gray-800 dark:text-gray-100 text-base whitespace-pre-wrap">{generatedParagraph}</p>
                                            {isAuthenticated && (
                                                <button
                                                    onClick={saveParagraphToHistory}
                                                    className="mt-3 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
                                                >
                                                    Lưu vào Lịch Sử
                                                </button>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'explain' && (
                            <div className="bg-white dark:bg-gray-700 p-6 md:p-8 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 transition-all duration-300 hover:shadow-xl">
                                <h2 className="text-2xl font-bold text-gray-800 dark:text-white mb-4">Giải thích từ/khái niệm Êđê</h2>
                                <p className="text-gray-600 dark:text-gray-400 mb-4">Nhập một từ hoặc khái niệm tiếng Êđê để nhận lời giải thích ngắn gọn bằng tiếng Việt.</p>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="explanationWord" className="block text-gray-700 dark:text-gray-300 text-sm font-semibold mb-2">
                                            Từ/Khái niệm (tiếng Êđê):
                                        </label>
                                        <input
                                            type="text"
                                            id="explanationWord"
                                            className="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition duration-200 ease-in-out text-gray-800 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 text-lg bg-gray-50 dark:bg-gray-800"
                                            placeholder="Ví dụ: Klei, Buôn, Mnuih Êđê..."
                                            value={explanationWord}
                                            onChange={(e) => setExplanationWord(e.target.value)}
                                        />
                                    </div>
                                    <button
                                        onClick={getExplanation}
                                        disabled={isLoadingExplanation}
                                        className="w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors"
                                    >
                                        {isLoadingExplanation ? <div className="loader"></div> : 'Giải Thích'}
                                    </button>
                                    {generatedExplanation && (
                                        <div className="mt-4 bg-purple-50 dark:bg-purple-900 p-4 rounded-lg border border-purple-200 dark:border-purple-700">
                                            <h3 className="text-md font-semibold text-purple-800 dark:text-purple-200 mb-1">Giải thích (tiếng Việt):</h3>
                                            <p className="text-gray-800 dark:text-gray-100 whitespace-pre-wrap">{generatedExplanation}</p>
                                            {isAuthenticated && (
                                                <button
                                                    onClick={saveExplanationToHistory}
                                                    className="mt-3 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
                                                >
                                                    Lưu vào Lịch Sử
                                                </button>
                                            )}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'textToSpeech' && (
                            <div className="bg-white dark:bg-gray-700 p-6 md:p-8 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 transition-all duration-300 hover:shadow-xl">
                                <h2 className="text-2xl font-bold text-gray-800 dark:text-white mb-4">Văn bản thành Giọng nói</h2>
                                <p className="text-gray-600 dark:text-gray-400 mb-4">Nhập văn bản và nghe ứng dụng đọc to.</p>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="speechSynthesisText" className="block text-gray-700 dark:text-gray-300 text-sm font-semibold mb-2">
                                            Văn bản muốn đọc:
                                        </label>
                                        <textarea
                                            id="speechSynthesisText"
                                            className="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200 ease-in-out text-gray-800 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 text-lg bg-gray-50 dark:bg-gray-800 min-h-[100px]"
                                            placeholder="Ví dụ: Kâo khăp hriăm klei Êđê. - Tôi thích học tiếng Êđê."
                                            value={speechSynthesisText}
                                            onChange={(e) => setSpeechSynthesisText(e.target.value)}
                                        ></textarea>
                                    </div>
                                    {voices.length > 0 && (
                                        <div>
                                            <label htmlFor="voiceSelect" className="block text-gray-700 dark:text-gray-300 text-sm font-semibold mb-2">
                                                Chọn giọng đọc:
                                            </label>
                                            <select
                                                id="voiceSelect"
                                                className="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition duration-200 ease-in-out text-gray-800 dark:text-white bg-gray-50 dark:bg-gray-800"
                                                value={selectedVoice ? selectedVoice.name : ''}
                                                onChange={(e) => setSelectedVoice(voices.find(voice => voice.name === e.target.value))}
                                            >
                                                {voices.map(voice => (
                                                    <option key={voice.name} value={voice.name}>
                                                        {voice.name} ({voice.lang}) {voice.default ? '(Mặc định)' : ''}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                    )}
                                    <div className="flex justify-center space-x-4">
                                        <button
                                            onClick={speakText}
                                            disabled={isSpeaking || !speechSynthesisText.trim()}
                                            className="px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors"
                                        >
                                            {isSpeaking ? 'Đang đọc...' : 'Đọc văn bản'}
                                        </button>
                                        <button
                                            onClick={stopSpeaking}
                                            disabled={!isSpeaking}
                                            className="px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-red-600 hover:bg-red-700 disabled:bg-gray-400 dark:disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors"
                                        >
                                            Dừng đọc
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* History tab content */}
                        {activeTab === 'history' && (
                            <div className="bg-white dark:bg-gray-700 p-6 md:p-8 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 transition-all duration-300 hover:shadow-xl">
                                <h2 className="text-2xl font-bold text-gray-800 dark:text-white mb-4">Lịch sử tương tác</h2>
                                <p className="text-gray-600 dark:text-gray-400 mb-4">Xem lại các đoạn văn, giải thích và tra cứu từ điển bạn đã tạo.</p>
                                {!isAuthenticated ? (
                                    <p className="text-gray-500 dark:text-gray-400 text-center py-8">
                                        Vui lòng đăng nhập để xem lịch sử. Ứng dụng sẽ tự động đăng nhập ẩn danh khi khởi chạy.
                                    </p>
                                ) : historyItems.length === 0 ? (
                                    <p className="text-gray-500 dark:text-gray-400 text-center py-8">Chưa có mục nào trong lịch sử.</p>
                                ) : (
                                    <div className="space-y-4">
                                        {historyItems.map(item => (
                                            <div key={item.id} className="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-200 dark:border-gray-600">
                                                <p className="text-sm text-gray-500 dark:text-gray-400 mb-2">
                                                    {formatTimestamp(item.timestamp)} - Loại: {
                                                        item.type === 'paragraph_generation' ? 'Tạo Đoạn Văn' :
                                                        item.type === 'explanation' ? 'Giải Thích' :
                                                        item.type === 'dictionary_lookup' ? 'Tra Từ Điển' :
                                                        'Không xác định'
                                                    }
                                                </p>
                                                {item.type === 'paragraph_generation' ? (
                                                    <>
                                                        <h4 className="font-semibold text-gray-700 dark:text-gray-300">Chủ đề: {item.prompt}</h4>
                                                        <p className="text-gray-800 dark:text-gray-100 whitespace-pre-wrap">{item.edeText}</p>
                                                        {item.wordCount && <p className="text-sm text-gray-600 dark:text-gray-400">Số từ mong muốn: {item.wordCount}</p>}
                                                    </>
                                                ) : item.type === 'explanation' ? (
                                                    <>
                                                        <h4 className="font-semibold text-gray-700 dark:text-gray-300">Từ/Khái niệm: {item.word}</h4>
                                                        <p className="text-gray-800 dark:text-gray-100 whitespace-pre-wrap">{item.explanationText}</p>
                                                    </>
                                                ) : item.type === 'dictionary_lookup' ? (
                                                    <>
                                                        <h4 className="font-semibold text-gray-700 dark:text-gray-300">Tra cứu: "{item.word}" ({item.sourceLang === 'ede' ? 'Êđê' : 'Việt'} → {item.targetLang === 'ede' ? 'Êđê' : 'Việt'})</h4>
                                                        <p className="text-gray-800 dark:text-gray-100 whitespace-pre-wrap">{item.result}</p>
                                                    </>
                                                ) : null}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                    {/* Message Modal */}
                    <MessageModal message={message} onClose={closeMessage} />
                </div>
            );
        }

        // TabButton Component for navigation tabs
        const TabButton = ({ tabName, activeTab, setActiveTab, children, disabled = false }) => (
            <button
                onClick={() => setActiveTab(tabName)}
                disabled={disabled}
                className={`px-4 py-2 text-lg font-medium rounded-t-lg transition-colors duration-200
                    ${activeTab === tabName
                        ? 'text-white bg-indigo-600 dark:bg-indigo-700 border-b-2 border-indigo-500 dark:border-indigo-400 shadow-md'
                        : 'text-gray-700 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400 border-b-2 border-transparent hover:border-indigo-300 dark:hover:border-indigo-600'
                    }
                    ${disabled ? 'opacity-50 cursor-not-allowed' : ''}
                `}
            >
                {children}
            </button>
        );

        // Render the App component to the 'root' div in the HTML
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
